<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-08 16:19:42" versao_xml="0.1"><tela titulo="Histórico de Contas a Pagar e Despesas Pagas">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" valor_padrao="select grid from empresa_local" />
    <procura condicao="codigo like &apos;2.1.%&apos;" id="conta" modelo="conta" requerido="sim" titulo="Conta" />
    <campo id="data_movto" modelo="periodo" titulo="Período movto" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <campo id="data_vencto" modelo="periodo" titulo="Período vencto" />
    <campo id="data_pgto" modelo="periodo" titulo="Período pgto" />
    <procura id="fornecedor" modelo="fornecedor" titulo="Fornecedor" />
    <procura id="contra_partida" modelo="conta" titulo="Contra-partida" />
    <selecao id="situacao" origem="values (1, &apos;Todas as contas a pagar&apos;), (2, &apos;Contas a pagar em aberto&apos;),      (3, &apos;Contas a pagar em aberto vencidas&apos;), (4, &apos;Contas a pagar em aberto a vencer&apos;),      (5, &apos;Contas a pagar pagas&apos;), (6, &apos;Contas a pagar pagas em atraso&apos;),      (7, &apos;Contas a pagar pagas ate o vencimento&apos;)" requerido="sim" titulo="Situacao" />
    <check id="opcao" titulo="Exibir despesas pagas no período informado" valor_padrao="select true" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Histórico de Contas a Pagar e Despesas Pagas/b&gt;&lt;/big&gt;

Este relatório permite ver o Histórico de Contas a Pagar e Despesas Pagas</ajuda><layout dados="select 
    (case when $opcao = 1 then &apos;H I S T Ó R I C O   D E   C O N T A S   A   P A G A R   E   D E S P E S A S   P A G A S&apos; else &apos;H I S T Ó R I C O   D E   C O N T A S   A   P A G A R&apos; end) as titulo1,
    m.*, 
    c.codigo||&apos; - &apos;||c.nome as conta_cod_nome, 
    c.codigo as conta, 
    p.codigo as fornecedor_codigo, 
    p.nome as fornecedor_nome, 
    (case when m.conta_creditar like &apos;1.%&apos; then m.data else movto_data_baixa_f(m.grid) end) as data_baixa ,
    (case when (child &lt;&gt; 0 or conta_debitar like &apos;3%&apos;) and (conta_creditar like &apos;1%&apos;) then &apos;OK&apos; else &apos;&apos; end) as situacao
from 
    movto m 
       join conta c on (m.conta_debitar=c.codigo) 
       left join pessoa p on (m.pessoa=p.grid) 
where 
    m.conta_creditar = $conta
and     (case when $data_movto_ini is null then true else m.data between $data_movto_ini and $data_movto_fim end)
and     (case when $data_vencto_ini is null then true else m.vencto between $data_vencto_ini and $data_vencto_fim end)
and     (case when $data_pgto_ini is null then true else movto_data_baixa_f(m.grid) between $data_pgto_ini and $data_pgto_fim end)
and     (case when $empresa is null then true else m.empresa = $empresa end) 
and     (case when $situacao = 2 then m.child=0 when $situacao = 3 then m.child=0 and m.vencto&lt;current_date when $situacao = 4 then m.child=0 and m.vencto&gt;=current_date when $situacao = 5 then m.child!=0 when $situacao = 6 then m.child!=0 and movto_data_baixa_f(m.grid) &gt; m.vencto else m.child!=0 and movto_data_baixa_f(m.grid) &lt;= m.vencto end)
union all 
select     
    (case when $opcao = 1 then &apos;H I S T Ó R I C O   D E   C O N T A S   A   P A G A R   E   D E S P E S A S   P A G A S&apos; else &apos;H I S T Ó R I C O   D E   C O N T A S   A   P A G A R&apos; end) as titulo1,
    m.*, 
    c.codigo||&apos; - &apos;||c.nome as conta_cod_nome, 
    c.codigo as conta, 
    p.codigo as fornecedor_codigo, 
    p.nome as fornecedor_nome, 
    (case when m.conta_creditar like &apos;1.%&apos; then m.data else movto_data_baixa_f(m.grid) end) as data_baixa ,
    (case when (child &lt;&gt; 0 or conta_debitar like &apos;3%&apos;) and (conta_creditar like &apos;1%&apos;) then &apos;OK&apos; else &apos;&apos; end) as situacao
from 
    movto m 
       join conta c on (m.conta_debitar=c.codigo) 
       left join pessoa p on (m.pessoa=p.grid) 
where 
    m.conta_debitar like &apos;3.%&apos; 
and     m.conta_creditar like &apos;1.%&apos; 
and    $opcao = 1
and     (case when $data_movto_ini is null then true else m.data between $data_movto_ini and $data_movto_fim end)
and     (case when $data_vencto_ini is null then true else m.vencto between $data_vencto_ini and $data_vencto_fim end)
and     (case when $empresa is null then true else m.empresa = $empresa end) 
and     (case when $situacao in (2,3,4) then false when $situacao = 6 then m.data &gt; m.vencto and not m.vencto is null else m.data &lt;= m.vencto and not m.vencto is null end)
order by 
    conta, 
    vencto, 
    data, 
    grid" id="4926af86b780ec1532e27002f617f068" ordem=" " titulo="Histórico de Contas a Pagar e Despesas Pagas"><apelidos>1  rel_posto_nome	tam=60
2  rel_data_hora	tam=16
3  titulo1		tam=115	alinha=centro
4  titulo2		tam=115	alinha=centro
5  conta_cod_nome	tam=60
6  fornecedor_nome	tam=30
7  data			tam=10	fmt=data
8  turno		tam=3	alinha=centro
9  documento		tam=10
10 vencto		tam=10	fmt=data
11 valor		tam=14	fmt=%.02f
12 situacao		tam=3	
13 data_baixa		tam=10	fmt=data
14 obs			tam=105
15 total_conta		tam=14	fmt=%.02f	func=soma	campo=valor	grupo=1
16 total_geral		tam=14	fmt=%.02f	func=soma	campo=valor
</apelidos><cab_pagina>
#1                                                                                                #2             
-------------------------------------------------------------------------------------------------------------------

#3
#4

+--------------------------------+------------+-----+------------+------------+----------------+-----+------------+
| Fornecedor                     | Dt. Movto  | Tur | Documento  |  Vencto    |          Valor | Sit | Dt. Pagto  |
|    Observacao                                                                                                   |
+--------------------------------+------------+-----+------------+------------+----------------+-----+------------+

</cab_pagina>

<cab_grupo nome="1" quebra="conta">
CONTA: #5
+--------------------------------+------------+-----+------------+------------+----------------+-----+------------+
</cab_grupo>

<detalhe>
| #6                             | #7         | #8  | #9         | #10        | #11            | #12 | #13        |
|    #14                                                                                                          |
</detalhe>

<rod_grupo nome="1">
+--------------------------------+------------+-----+------------+------------+----------------+-----+------------+
| TOTAL CONTA                                                                 | #15            |                  |
+-----------------------------------------------------------------------------+----------------+------------------+

</rod_grupo>

<rod_pagina>
+--------------------------------+------------+-----+------------+------------+----------------+-----+------------+
</rod_pagina>

<rod_relat>
+-----------------------------------------------------------------------------+----------------+------------------+
| TOTAL GERAL                                                                 | #16            |                  |
+-----------------------------------------------------------------------------+----------------+------------------+
</rod_relat>
</layout></relatorio>