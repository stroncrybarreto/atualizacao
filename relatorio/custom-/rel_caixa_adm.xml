<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-04 16:51:04" versao_xml="0.1"><tela titulo="Caixa ADM">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" requerido="sim" titulo="Empresa" valor_padrao="select grid from empresa_local" />
    <procura condicao=" codigo in (select conta from empresa_conta where empresa=$empresa and conta in (select conta from caixa_adm_conf))" id="conta" modelo="conta" requerido="sim" titulo="Conta" />
    <campo id="data" modelo="periodo" titulo="Período" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Caixa ADM/b&gt;&lt;/big&gt;

Este relatório permite ver o Caixa ADM</ajuda><layout dados="select 
    mv.documento, 
    mv.motivo, 
    mv.data, 
    mv.conta_creditar, 
    mv.conta_debitar, 
    mv.turno, 
    mv.seq, 
    p.nome as pessoa, 
    mv.valor, 
    mv.grid, 
    m.nome as motivo_nome,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then mv.valor else (0-mv.valor) end) as saldo_valor,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then &apos;C&apos; else &apos;D&apos; end) as op,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then mv.valor end) as valor_credito,
    (case when ((mv.conta_creditar = $conta) or (mv.conta_creditar = c.conta_cheque)) then mv.valor end) as valor_debito,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_creditar = $conta)) then mv.valor end) as dinheiro,
    (case when ((mv.conta_debitar = c.conta_cheque) or (mv.conta_creditar = c.conta_cheque)) then mv.valor end) as cheque,
    (conta_saldo($conta,$data_ini) + conta_saldo(c.conta_cheque,$data_ini)) as saldo_ini,
    (select nome from conta where codigo = $conta) as conta_nome
from 
    movto mv 
       left join pessoa p on (p.grid=mv.pessoa) 
       join motivo_movto m on (m.grid=mv.motivo) 
       left join caixa_adm_conf c on (c.conta = $conta and mv.conta_debitar = c.conta_cheque)
where 
     mv.empresa = $empresa
and     mv.data between $data_ini and $data_fim
and     (mv.conta_debitar=$conta or mv.conta_debitar=(select conta_cheque from caixa_adm_conf where conta=$conta)) 
union all 
select 
    mv.documento, 
    mv.motivo, 
    mv.data, 
    mv.conta_creditar, 
    mv.conta_debitar, 
    mv.turno, 
    mv.seq, 
    p.nome as pessoa, 
    mv.valor, 
    mv.grid, 
    m.nome as motivo_nome,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then mv.valor else (0-mv.valor) end) as saldo_valor,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then &apos;C&apos; else &apos;D&apos; end) as op,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_debitar = c.conta_cheque)) then mv.valor end) as valor_credito,
    (case when ((mv.conta_creditar = $conta) or (mv.conta_creditar = c.conta_cheque)) then mv.valor end) as valor_debito,
    (case when ((mv.conta_debitar = $conta) or (mv.conta_creditar = $conta)) then mv.valor end) as dinheiro,
    (case when ((mv.conta_debitar = c.conta_cheque) or (mv.conta_creditar = c.conta_cheque)) then mv.valor end) as cheque,
    (conta_saldo($conta,$data_ini) + conta_saldo(c.conta_cheque,$data_ini)) as saldo_ini,
    (select nome from conta where codigo = $conta) as conta_nome
from 
    movto mv 
       left join pessoa p on (p.grid=mv.pessoa) 
       join motivo_movto m on (m.grid=mv.motivo)
       left join caixa_adm_conf c on (c.conta = $conta and mv.conta_debitar = c.conta_cheque)
where 
     mv.empresa = $empresa
and     mv.data between $data_ini and $data_fim
and     (mv.conta_creditar=$conta or mv.conta_creditar=(select conta_cheque from caixa_adm_conf where conta=$conta)) 
order by 
    data, 
    turno, 
    seq, 
    grid" id="4926af86b780ec1532e27002f617f068" ordem=" " titulo="Caixa ADM"><apelidos>1  rel_posto_nome   	tam=60
2  rel_data_hora    	tam=25
7  conta_nome		tam=60
9  data			tam=11  alinha=esquerda  fmt=data
10 motivo_nome	        tam=26  alinha=esquerda
11 pessoa               tam=21  alinha=esquerda
12 valor                tam=13  alinha=direita   fmt=%.02f  
13 op			tam=3   alinha=centro
14 saldo		tam=13  alinha=direita   fmt=%.02f  expr=total_saldo_valor+saldo_ini
15 total_debito		tam=15	alinha=direita	 fmt=%.02f  func=soma	campo=valor_debito
16 total_credito	tam=15  alinha=direita   fmt=%.02f  func=soma	campo=valor_credito
17 saldo_final		tam=15  alinha=direita   fmt=%.02f  expr=total_credito-total_debito
21 total_dinheiro	tam=15				    func=soma	campo=dinheiro
18 valor_dinheiro       tam=15  alinha=direita   fmt=%.02f  expr=(total_dinheiro+saldo_ini)
19 valor_cheque         tam=15  alinha=direita   fmt=%.02f  func=soma	campo=cheque
20 titulo               tam=80
22 data_ini		tam=10  fmt=data
23 data_fim		tam=10  fmt=data
24 saldo_ini		tam=13  alinha=direita   fmt=%.02f
25 total_saldo_valor	tam=13			 fmt=%.02f  func=soma	campo=saldo_valor</apelidos><cab_pagina>
#1                                                                                         #2
------------------------------------------------------------------------------------------------------------

            	                   Caixa ADM - #7                                                          
		                    Período #22        - #23       

+-------------+------------------------------+-----------------------+---------------+-----+---------------+
|     DATA    |           MOTIVO             |         PESSOA        |     VALOR     |  OP |     SALDO     |  
+-------------+------------------------------+-----------------------+---------------+-----+---------------+
| #22         | SALDO INICIAL                |                       |          0,00 |  -  | #24           |
</cab_pagina>

<detalhe>
| #9          | #10                          | #11                   | #12           | #13 | #14           |             
</detalhe>
<rod_relat>
+-------------+------------------------------+-----------------------+---------------+-----+---------------+

+----------------+----------------+----------------+----------------+----------------+
|  Total débito  |  Total crédito | Valor dinheiro |  Valor Cheque  |   Saldo Final  |
+----------------+----------------+----------------+----------------+----------------+
|#15             |#16             |#18             |#19             |#17             |
+----------------+----------------+----------------+----------------+----------------+
</rod_relat>
<rod_pagina>
------------------------------------------------------------------------------------------------------
</rod_pagina>
</layout></relatorio>