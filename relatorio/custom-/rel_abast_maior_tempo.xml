<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-03 16:31:12" versao_xml="0.1"><tela titulo="Abastecimentos maior tempo pendentes">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" />
    <campo id="data" modelo="periodo" requerido="sim" titulo="Período" valor_padrao="SELECT to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <campo id="tempo" tipo="inteiro" titulo="Tempo mínimo pendente(min)" />
    <campo id="limite" tipo="inteiro" titulo="Limite de abastecimentos" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Abastecimentos maior tempo pendentes&lt;/b&gt;&lt;/big&gt;

Este relatório permite ver os Abastecimentos maior tempo pendentes</ajuda><layout dados="select      e.nome_reduzido as empresa_nome,      p.nome as produto_nome,      l.bico,      to_char(l.hora,&apos;dd/mm hh24:mi&apos;) as hora,      to_char(l.hora_abastec,&apos;dd/mm hh24:mi&apos;) as hora_abastec,      (l.hora - l.hora_abastec)::time::text as tempo,     l.documento as cupom,      l.quantidade as litros,      l.valor,      substr(split_part(p.nome,&apos; &apos;,1),1,1)||substr(split_part(p.nome,&apos; &apos;,2),1,1) as nome_produto_reduzido,     (case when (select count(*) from movto m where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) = 0 then 1 else (select count(*) from movto m where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) end) as qtde,     coalesce((select max(mm.nome) from movto m join motivo_movto mm on (mm.grid=m.motivo) where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid),&apos;DINHEIRO&apos;) as motivo_nome,     (select max(m.valor) from movto m where m.motivo=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) as valor_pgto from      lancto l         join produto p on (p.grid=l.produto)         join empresa e on (e.grid=l.empresa)  where      (case when $empresa is null then true else l.empresa = $empresa end)  and     l.data between $data_ini and $data_fim and     (l.hora - l.hora_abastec) &gt; coalesce($tempo/60||&apos;:&apos;||$tempo%60,&apos;00:10:00&apos;)::interval and     not l.hora_abastec is null  order by      l.hora_abastec::date,      (l.hora - l.hora_abastec) desc limit    coalesce($limite,10)" id="4926af86b780ec1532e27002f617f068" ordem="" titulo="Sem Agrupamento"><apelidos>98 rel_posto_nome		tam=60
99 rel_data_hora		tam=18
1  produto_nome			tam=17
2  est_inicial			tam=11	fmt=%.02f
3  hora_abastec			tam=11
4  hora				tam=11
5  cupom			tam=6
6  bico				tam=2
7  nome_produto_reduzido	tam=2
8  litros			tam=8			alinha=direita
9  qtde				tam=2	fmt=%02d
10 valor			tam=8	fmt=%.02f	alinha=direita
11 motivo_nome			tam=22
12 valor_pgto			tam=9	fmt=%.02f	alinha=direita
13 empresa_nome			tam=100
15 tempo			tam=8
16 data_ini			tam=10	fmt=data
17 data_fim			tam=10	fmt=data</apelidos><cab_pagina>
#98                                                                                                    #99              
-------------------------------------------------------------------------------------------------------------------------

                                 ABASTECIMENTOS  QUE  ESTIVERAM  MAIOR  TEMPO  PENDENTES                              
                                              Periodo: #16      a #17       

</cab_pagina>
<cab_grupo nome="1" quebra="empresa_nome">
+-----------------------------------------------------------------------------------------------------------------------+
| EMPRESA: #13                                                                                                          |
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+
| Hora Abast  | Hora Cupom  | Tempo    | Cupom  | Bico  |   Litros |    Valor | Qtde / Forma Pgto           |   Vl Pgto |
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+
</cab_grupo>
<detalhe>
| #3          | #4          | #15      | #5     | #6 #7 | #8       | #10      | #9 / #11                    | #12       |
</detalhe>
<rod_grupo nome="1">
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+

</rod_grupo>
</layout><layout dados="select 
    e.nome_reduzido as empresa_nome, 
    p.nome as produto_nome, 
    l.bico, 
    to_char(l.hora,&apos;dd/mm hh24:mi&apos;) as hora, 
    to_char(l.hora_abastec,&apos;dd/mm hh24:mi&apos;) as hora_abastec, 
    (l.hora - l.hora_abastec)::time::text as tempo,
    l.documento as cupom, 
    l.quantidade as litros, 
    l.valor, 
    substr(split_part(p.nome,&apos; &apos;,1),1,1)||substr(split_part(p.nome,&apos; &apos;,2),1,1) as nome_produto_reduzido,
    (case when (select count(*) from movto m where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) = 0 then 1 else (select count(*) from movto m where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) end) as qtde,
    coalesce((select max(mm.nome) from movto m join motivo_movto mm on (mm.grid=m.motivo) where m.motivo!=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid),&apos;DINHEIRO&apos;) as motivo_nome,
    (select max(m.valor) from movto m where m.motivo=(select motivo from motivo_config where chave=&apos;VENDA&apos;) and m.mlid=l.mlid) as valor_pgto,
    l.data,
    l.conta,
    l.turno
from 
    lancto l 
       join produto p on (p.grid=l.produto) 
       join empresa e on (e.grid=l.empresa) 
where 
    (case when $empresa is null then true else l.empresa = $empresa end) 
and     l.data between $data_ini and $data_fim
and     (l.hora - l.hora_abastec)::text &gt; coalesce($tempo,&apos;00:10:00&apos;)
and     not l.hora_abastec is null 
order by 
    l.data, 
    (l.hora - l.hora_abastec) desc
limit    coalesce($limite,20)" id="5ef722c740f29d1ee982786b2521c081" ordem="" titulo="Agrupar por caixa e turno"><apelidos>98 rel_posto_nome		tam=60
99 rel_data_hora		tam=18
1  produto_nome			tam=17
2  est_inicial			tam=11	fmt=%.02f
3  hora_abastec			tam=11
4  hora				tam=11
5  cupom			tam=6
6  bico				tam=2
7  nome_produto_reduzido	tam=2
8  litros			tam=8	alinha=direita
9  qtde				tam=2	fmt=%02d
10 valor			tam=8	alinha=direita fmt=%.02f
11 motivo_nome			tam=22
12 valor_pgto			tam=9	alinha=direita fmt=%.02f
13 empresa_nome			tam=100
14 filtro			tam=121	alinha=centro
15 tempo			tam=8
16 conta			tam=11
17 turno			tam=10	alinha=esquerda
18 data				tam=10	fmt=data
19 total_litros			tam=8	alinha=direita			func=soma	campo=litros		grupo=2
20 total_valor			tam=8	alinha=direita	fmt=%.02f	func=soma	campo=valor		grupo=2
21 total_valor_pgto		tam=9	alinha=direita	fmt=%.02f	func=soma	campo=valor_pgto	grupo=2
22 data_ini			tam=10	fmt=data
23 data_fim			tam=10	fmt=data</apelidos><cab_pagina>
#98                                                                                                    #99              
-------------------------------------------------------------------------------------------------------------------------

                                 ABASTECIMENTOS  QUE  ESTIVERAM  MAIOR  TEMPO  PENDENTES
                                              Periodo: #22      a #23       

</cab_pagina>

<cab_grupo nome="1" quebra="data">
Data: #18
</cab_grupo>

<cab_grupo nome="2" quebra="data, conta, turno">
+-----------------------------------------------------------------------------------------------------------------------+
| Caixa: #16         Turno: #17                                                                                         |
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+
| Hora Abast  | Hora Cupom  | Tempo    | Cupom  | Bico  |   Litros |    Valor | Qtde / Forma Pgto           |   Vl Pgto |
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+
</cab_grupo>
<detalhe>
| #3          | #4          | #15      | #5     | #6 #7 | #8       | #10      | #9 / #11                    | #12       |
</detalhe>
<rod_grupo nome="2">
+-------------+-------------+----------+--------+-------+----------+----------+-----------------------------+-----------+
|                                                       | #19      | #20      |                             | #21       |
+-------------------------------------------------------+----------+----------+-----------------------------+-----------+

</rod_grupo>
<rod_grupo nome="1">
</rod_grupo></layout></relatorio>