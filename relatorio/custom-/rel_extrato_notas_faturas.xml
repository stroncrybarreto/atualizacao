<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-22 10:00:41" versao_xml="0.1"><tela titulo="Extrato de Notas e Faturas">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" />
    <procura id="conta_nota" modelo="conta" requerido="sim" titulo="Conta Notas" valor_padrao="(select &apos;1.3.03&apos;)" />
    <procura id="conta_fatura" modelo="conta" requerido="sim" titulo="Conta Faturas" valor_padrao="(select &apos;1.3.04&apos;)" />
    <procura id="grupo" modelo="grupo_pessoa" tiutlo="Cliente" />
    <procura id="pessoa" modelo="cliente" />
    <campo id="data" modelo="periodo" valor_padrao="SELECT to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <campo expande="False" id="data_ref" tipo="data" titulo="Data Referência" />
  </quadro>
  <quadro titulo="Modo de exibição">
    <check id="sem_fatura" titulo="Não exibir clientes sem fatura" />
  </quadro>
  <quadro titulo="Ordenação">
    <selecao id="ordenar" origem="values(1, &apos;Documento&apos;), (2, &apos;Vencimento&apos;), (3, &apos;Valor&apos;)" requerido="sim" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Extrato de Notas e Faturas&lt;/b&gt;&lt;/big&gt;

Relatório que demostra as notas e faturas de notas de clientes. Possui os seguintes modos de exibição:

&lt;b&gt;Sintético:&lt;/b&gt; Para cada cliente, exibe o total de notas e relaciona as faturas em aberto.

&lt;b&gt;Analítico:&lt;/b&gt; Para cada cliente, exibe de forma detalhada as notas e faturas.

&lt;b&gt;Resumido:&lt;/b&gt; Exibe para cada cliente os valores de notas e faturas. Neste modo, todos os valores exibidos levam em conta o período de emissão das notas, ou seja, não considera a data de emissão da fatura. O filtro de data de referencia e ordenação não afetam este modo de exibição.</ajuda><layout dados="SELECT ((case when $empresa is null then &apos;&apos; else &apos;Empresa: &apos;||pessoa_nome_f($empresa) end)||&apos; - &apos;|| (case when $pessoa is null then &apos;&apos; else &apos;Apenas Cliente: &apos;||pessoa_nome_f($pessoa) end)||&apos; - &apos;|| (case when ($data_ini is not null and $data_fim is not null) then &apos;Emissão entre &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;)||&apos; e &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is not null and $data_fim is null) then &apos;Emissão a partir de &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is null and $data_fim is not null) then &apos;Emissão até &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) end)) as titulo2, (case when t.tipo=0 then &apos;NENHUMA FATURA EM ABERTO&apos; else mm.nome end) as motivo_nome, t.tipo, p.codigo as pessoa_codigo, p.nome as pessoa_nome, p.grid as pessoa, t.documento1 as documento, t.data1 as data, t.vencto1 as vencto, sum(t.valor) as valor, (case when t.tipo=1 then 0 else sum(t.valor) end) as total_nota, (case when t.tipo=0 then null else t.valor end) as valor_fatura FROM ( select m.*, 0::int as tipo, null as documento1, null as data1, null as vencto1 from movto m left join pessoa p on (p.grid=m.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $data_ref is null then m.child=0 else true end) and (case when $empresa is null then true else m.empresa=$empresa end) and (case when $pessoa is null then true else m.pessoa=$pessoa end) and (case when $grupo is null then true else gp.grid=$grupo end) and m.conta_debitar=$conta_nota and (case when ($data_ini is not null and $data_fim is not null) then m.data between $data_ini and $data_fim when ($data_ini is not null and $data_fim is null) then m.data &gt;= $data_ini when ($data_ini is null and $data_fim is not null) then m.data &lt;= $data_fim end) and (case when $data_ref is null then true else (m.data&lt;=$data_ref and (m.child=0 or (m.child!=0 and movto_data_baixa_f(m.grid)&gt;$data_ref))) end) UNION ALL select m.*, 1::int as tipo, m.documento as documento1, m.data as data1, m.vencto as vencto1 from movto m left join pessoa p on (p.grid=m.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $data_ref is null then m.child=0 else true end) and (case when $empresa is null then true else m.empresa=$empresa end) and (case when $pessoa is null then true else m.pessoa=$pessoa end) and (case when $grupo is null then true else gp.grid=$grupo end) and (m.conta_creditar = &apos;4.4.1&apos; or m.conta_creditar=$conta_nota) and (m.conta_debitar = &apos;4.4.1&apos; or m.conta_debitar=$conta_fatura) and m.conta_creditar=$conta_nota and m.conta_debitar=$conta_fatura and (case when ($data_ini is not null and $data_fim is not null) then m.data between $data_ini and $data_fim when ($data_ini is not null and $data_fim is null) then m.data &gt;= $data_ini when ($data_ini is null and $data_fim is not null) then m.data &lt;= $data_fim else true end) and (case when $data_ref is null then true else (m.data&lt;=$data_ref and (m.child=0 or (m.child!=0 and movto_data_baixa_f(m.grid)&gt;$data_ref))) end) ) t left join pessoa p on (t.pessoa=p.grid) left join motivo_movto mm on (t.motivo=mm.grid) WHERE (case when $sem_fatura=1 then t.tipo&lt;&gt;0 else true end) GROUP BY motivo_nome, t.tipo, pessoa_codigo, pessoa_nome, p.grid, t.documento1, t.data1, t.vencto1, valor_fatura ORDER BY (case when $ordenar=1 then t.documento1 else NULL end) ASC, (case when $ordenar=2 then t.vencto1 else NULL end) ASC, (case when $ordenar=3 then sum(t.valor) else NULL end) ASC, p.nome, p.grid, t.tipo  " id="2c0c8a36450a7c2187f0b9a8c8c79074" ordem=" pessoa_nome" titulo="Sintético - Exibir total de notas e detalhar faturas"><apelidos>1  rel_posto_nome		tam=60
2  rel_data_hora		tam=18
4  titulo2			tam=120	alinha=centro
5  pessoa_codigo		tam=6 	fmt=%d
6  pessoa_nome			tam=45
7  tipo_nome			tam=20
8  documento			tam=9
9  data				tam=10	fmt=data
10 motivo_nome			tam=60
11 vencto			tam=10	fmt=data
12 valor			tam=13	fmt=%.02f
13 valor_fatura			tam=13	fmt=%.02f
14 total_nota			tam=13	fmt=%.02f	
15 total_fatura			tam=13	fmt=%.02f	func=soma 	campo=valor_fatura	grupo=1
16 total_pessoa			tam=13	fmt=%.02f	func=soma	campo=valor		grupo=1
17 total_geral_nota		tam=13	fmt=%.02f	func=soma	campo=total_nota
18 total_geral_fatura		tam=13	fmt=%.02f	func=soma	campo=valor_fatura	
19 total_geral			tam=13	fmt=%.02f	func=soma	campo=valor
20 bairro			tam=20
21 cpf				tam=20</apelidos><cab_pagina>
#1                                                                                                      #2              
------------------------------------------------------------------------------------------------------------------------

                            E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Sintetico
#4

</cab_pagina>

<cab_grupo nome="1" quebra="pessoa_nome">
Cliente: #5     - #6                                                                     Total de notas: #14
+-----------+------------+----------------------------------------------------------------+------------+---------------+
| Documento | Dt.Emissao | Motivo                                                         | Vencimento |         Valor |
+-----------+------------+----------------------------------------------------------------+------------+---------------+
</cab_grupo>
<detalhe>
| #8        | #9         | #10                                                            | #11        | #13           |
</detalhe>
<rod_grupo nome="1">
+-----------+------------+----------------------------------------------------------------+------------+---------------+
|                                                                                    Total de FATURAS: | #15           |
|                                                                                    Total do CLIENTE: | #16           |
+------------------------------------------------------------------------------------------------------+---------------+

</rod_grupo>

<rod_pagina>
+-----------+------------+----------------------------------------------------------------+------------+---------------+
</rod_pagina>

<rod_relat>

+------------------------------------------------------------------------------------------------------+---------------+
|                                                                                      Total de NOTAS: | #17           |
|                                                                                    Total de FATURAS: | #18           |
|                                                                                         Total GERAL: | #19           |
+------------------------------------------------------------------------------------------------------+---------------+
</rod_relat></layout><layout dados="SELECT ((case when $empresa is null then &apos;&apos; else &apos;Empresa: &apos;||pessoa_nome_f($empresa) end)||&apos; - &apos;|| (case when $pessoa is null then &apos;&apos; else &apos;Apenas Cliente: &apos;||pessoa_nome_f($pessoa) end)||&apos; - &apos;|| (case when ($data_ini is not null and $data_fim is not null) then &apos;Emissão entre &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;)||&apos; e &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is not null and $data_fim is null) then &apos;Emissão a partir de &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is null and $data_fim is not null) then &apos;Emissão até &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) end)) as titulo2, (select nome from conta where codigo=t.conta_debitar limit 1) as tipo_nome, mm.nome as motivo_nome, t.tipo, p.codigo as pessoa_codigo, p.nome as pessoa_nome, p.grid as pessoa, t.documento as documento, t.data as data, t.vencto as vencto, t.valor as valor, (case when t.tipo=1 then 0 else t.valor end) as valor_nota, (case when t.tipo=0 then 0 else t.valor end) as valor_fatura FROM ( select m.*, 0::int as tipo, null as documento1, null as data1, null as vencto1 from movto m left join pessoa p on (p.grid=m.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $data_ref is null then m.child=0 else true end) and (case when $empresa is null then true else m.empresa=$empresa end) and (case when $pessoa is null then true else m.pessoa=$pessoa end) and (case when $grupo is null then true else gp.grid=$grupo end) and m.conta_debitar=$conta_nota and (case when ($data_ini is not null and $data_fim is not null) then m.data between $data_ini and $data_fim when ($data_ini is not null and $data_fim is null) then m.data &gt;= $data_ini when ($data_ini is null and $data_fim is not null) then m.data &lt;= $data_fim end) and (case when $data_ref is null then true else (m.data&lt;=$data_ref and (m.child=0 or (m.child!=0 and movto_data_baixa_f(m.grid)&gt;$data_ref))) end) UNION ALL select m.*, 1::int as tipo, m.documento as documento1, m.data as data1, m.vencto as vencto1 from movto m left join pessoa p on (p.grid=m.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $data_ref is null then m.child=0 else true end) and (case when $empresa is null then true else m.empresa=$empresa end) and (case when $pessoa is null then true else m.pessoa=$pessoa end) and (case when $grupo is null then true else gp.grid=$grupo end) and (m.conta_creditar = &apos;4.4.1&apos; or m.conta_creditar=$conta_nota) and (m.conta_debitar = &apos;4.4.1&apos; or m.conta_debitar=$conta_fatura) and m.conta_creditar=$conta_nota and m.conta_debitar=$conta_fatura and (case when ($data_ini is not null and $data_fim is not null) then m.data between $data_ini and $data_fim when ($data_ini is not null and $data_fim is null) then m.data &gt;= $data_ini when ($data_ini is null and $data_fim is not null) then m.data &lt;= $data_fim else true end) and (case when $data_ref is null then true else (m.data&lt;=$data_ref and (m.child=0 or (m.child!=0 and movto_data_baixa_f(m.grid)&gt;$data_ref))) end) ) t left join pessoa p on (t.pessoa=p.grid) left join motivo_movto mm on (t.motivo=mm.grid) ORDER BY (case when $ordenar=1 then t.documento else NULL end) ASC, (case when $ordenar=2 then t.vencto else NULL end) ASC, (case when $ordenar=3 then t.valor else NULL end) ASC, p.nome, p.grid, t.tipo " id="183208d5d28dad0e7805225f13c64dab" ordem=" pessoa_nome" titulo="Analítico - Detalhar notas e faturas em aberto"><apelidos>1  rel_posto_nome		tam=60
2  rel_data_hora		tam=18
4  titulo2			tam=120	alinha=centro
5  pessoa_codigo		tam=6 	fmt=%d
6  pessoa_nome			tam=45
7  tipo_nome			tam=20
8  documento			tam=9
9  data				tam=10	fmt=data
10 motivo_nome			tam=60
11 vencto			tam=10	fmt=data
12 valor			tam=13	fmt=%.02f
13 subtotal			tam=13	fmt=%.02f	func=soma	campo=valor		grupo=2	
15 total_fatura			tam=13	fmt=%.02f	func=soma 	campo=valor		grupo=1
16 total_pessoa			tam=13	fmt=%.02f	func=soma	campo=valor		grupo=1
17 total_geral_nota		tam=13	fmt=%.02f	func=soma	campo=valor_nota
18 total_geral_fatura		tam=13	fmt=%.02f	func=soma	campo=valor_fatura	
19 total_geral			tam=13	fmt=%.02f	func=soma	campo=valor
20 bairro			tam=20
21 cpf				tam=20</apelidos><cab_pagina>
#1                                                                                                      #2              
------------------------------------------------------------------------------------------------------------------------

                            E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Analitico
#4

</cab_pagina>

<cab_grupo nome="1" quebra="pessoa_nome">
Cliente: #5     - #6
+-----------+------------+----------------------------------------------------------------+------------+---------------+
| Documento | Dt.Emissao | Motivo                                                         | Vencimento |         Valor |
+-----------+------------+----------------------------------------------------------------+------------+---------------+
</cab_grupo>
<cab_grupo nome="2" quebra="pessoa_nome,tipo">
| #7                                                                                                                   |
</cab_grupo>
<detalhe>
| #8        | #9         | #10                                                            | #11        | #12           |
</detalhe>
<rod_grupo nome="2">
|                                                                                               Total: | #13           |
</rod_grupo>
<rod_grupo nome="1">
+-----------+------------+----------------------------------------------------------------+------------+---------------+
|                                                                                    Total do CLIENTE: | #16           |
+------------------------------------------------------------------------------------------------------+---------------+

</rod_grupo>

<rod_pagina>
+-----------+------------+----------------------------------------------------------------+------------+---------------+
</rod_pagina>

<rod_relat>

+------------------------------------------------------------------------------------------------------+---------------+
|                                                                                      Total de NOTAS: | #17           |
|                                                                                    Total de FATURAS: | #18           |
|                                                                                         Total GERAL: | #19           |
+------------------------------------------------------------------------------------------------------+---------------+
</rod_relat></layout><layout dados="SELECT ((case when $empresa is null then &apos;&apos; else &apos;Empresa: &apos;||pessoa_nome_f($empresa) end)||&apos; - &apos;|| (case when $pessoa is null then &apos;&apos; else &apos;Apenas Cliente: &apos;||pessoa_nome_f($pessoa) end)||&apos; - &apos;|| (case when ($data_ini is not null and $data_fim is not null) then &apos;Emissão entre &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;)||&apos; e &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is not null and $data_fim is null) then &apos;Emissão a partir de &apos;||to_char($data_ini::date, &apos;DD/MM/YYYY&apos;) when ($data_ini is null and $data_fim is not null) then &apos;Emissão até &apos;||to_char($data_fim::date, &apos;DD/MM/YYYY&apos;) end)) as titulo2, temp.* FROM ( select mov.nome as cliente_nome, sum(mov.valor) as nota_emitida, sum(mov.pendente) as nota_pendente, sum((case when mov.conta_baixa=$conta_fatura then mov.valor else 0::float end)) as nota_faturada, sum((case when mov.conta_baixa=$conta_fatura and mov.fatura_pendente=0 then mov.valor else 0::float end)) as fatura_pendente from ( select pessoa_nome_f(m.pessoa) as nome, m.valor, m.child, (case when m.child=0 then m.valor else 0::float end) as pendente, (select m1.conta_debitar from movto m1 join movto_map mm on (m1.grid=mm.child) where mm.parent=m.grid limit 1) as conta_baixa, (select m1.child from movto m1 join movto_map mm on (m1.grid=mm.child) where mm.parent=m.grid limit 1) as fatura_pendente from movto m join pessoa p on (m.pessoa=p.grid) where m.conta_debitar=$conta_nota and (case when $empresa is null then true else m.empresa=$empresa end) and (case when $grupo is null then true else p.grupo=$grupo end) and (case when $pessoa is null then true else m.pessoa=$pessoa end) and (case when ($data_ini is not null and $data_fim is not null) then m.data between $data_ini and $data_fim when ($data_ini is not null and $data_fim is null) then m.data &gt;= $data_ini when ($data_ini is null and $data_fim is not null) then m.data &lt;= $data_fim else true end) ) mov group by mov.nome order by mov.nome ) temp WHERE (case when $sem_fatura=1 then temp.nota_faturada&gt;0 else true end) ORDER BY temp.cliente_nome " id="99f2bf5aff3c5101f5b3479ccd622472" ordem=" " titulo="Resumido - Exibir total de notas e faturas por cliente"><apelidos>1  rel_posto_nome			tam=60
2  rel_data_hora			tam=18
3  titulo1				tam=146	alinha=centro
4  titulo2				tam=146	alinha=centro

10 cliente_nome				tam=30

20 nota_emitida				tam=12	fmt=%.02f
21 nota_recebida			tam=12	fmt=%.02f	expr=nota_emitida-nota_faturada-nota_pendente
22 nota_pendente			tam=12	fmt=%.02f
23 nota_faturada			tam=12	fmt=%.02f
24 fatura_recebida			tam=12	fmt=%.02f	expr=nota_faturada-fatura_pendente
25 fatura_pendente			tam=12	fmt=%.02f
26 subtotal_recebido			tam=12	fmt=%.02f	expr=nota_recebida+fatura_recebida
27 subtotal_pendente			tam=12	fmt=%.02f	expr=nota_pendente+fatura_pendente

80 total_nota_emitida			tam=12	fmt=%.02f	func=soma	campo=nota_emitida
81 total_nota_recebida			tam=12	fmt=%.02f	func=soma	campo=nota_recebida
82 total_nota_pendente			tam=12	fmt=%.02f	func=soma	campo=nota_pendente
83 total_nota_faturada			tam=12	fmt=%.02f	func=soma	campo=nota_faturada
84 total_fatura_recebida		tam=12	fmt=%.02f	func=soma	campo=fatura_recebida
85 total_fatura_pendente		tam=12	fmt=%.02f	func=soma	campo=fatura_pendente
86 total_recebido			tam=12	fmt=%.02f	func=soma	campo=subtotal_recebido
87 total_pendente			tam=12	fmt=%.02f	func=soma	campo=subtotal_pendente</apelidos><cab_pagina>
#1                                                                                                                                #2              
--------------------------------------------------------------------------------------------------------------------------------------------------

                                         E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Resumido
#4

+--------------------------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
|                                |       Notas |       Notas |       Notas |       Notas |     Faturas |      Fatura |       Total |       Total |
| Cliente                        |    Emitidas |   Recebidas |   Pendentes |   Faturadas |   Recebidas |   Pendentes |    Recebido |    Pendente |
+--------------------------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</cab_pagina>

<detalhe>
| #10                            |#20          |#21          |#22          |#23          |#24          |#25          |#26          |#27          |
</detalhe>

<rod_relat>
+--------------------------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
| TOTAL                          |#80          |#81          |#82          |#83          |#84          |#85          |#86          |#87          |
+--------------------------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</rod_relat>

<rod_pagina>
+--------------------------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</rod_pagina></layout></relatorio>