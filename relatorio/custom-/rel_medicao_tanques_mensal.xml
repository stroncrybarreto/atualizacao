<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-18 16:38:30" versao_xml="0.1"><tela titulo="Medição de Tanques Mensal">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" requerido="sim" titulo="Empresa" />
    <campo id="data" modelo="periodo" requerido="sim" tipo="data" titulo="Período" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Medição de Tanques Mensal&lt;/b&gt;&lt;/big&gt;

Este relatório permite ver as Medição de Tanques Mensal</ajuda><layout dados="select distinct
    grid, 
         tanque, 
    combustivel,
         pessoa_nome(empresa) as empresa, 
         data_metragem,
         coalesce((select l.valor from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = (t.data_metragem::date -1)),0) as medicao_ant, 
         coalesce((select l.quantidade from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = (t.data_metragem-1)),0) as litragem_ant, 
         coalesce((select l.valor from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = t.data_metragem),0) as medicao_atual, 
         coalesce((select l.quantidade from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = t.data_metragem),0) as litragem_atual, 
         coalesce((select sum(l.quantidade) from lancto l where l.empresa=t.empresa and (l.operacao=&apos;E&apos; or l.operacao=&apos;TE&apos;) and l.deposito=t.grid and l.data = t.data_metragem),0) as entrada, 
         coalesce((select sum(l.quantidade) from lancto l where l.empresa=t.empresa and (l.operacao=&apos;V&apos; or l.operacao=&apos;TS&apos;) and l.deposito=t.grid and l.data = t.data_metragem),0) as bombas,
    coalesce((select sum(l.quantidade) from lancto l where l.empresa=t.empresa and (l.operacao=&apos;E&apos; or l.operacao=&apos;TE&apos;) and l.deposito=t.grid and l.data = t.data_metragem)+(select l.quantidade from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = (t.data_metragem::date -1)),0) as estoque,
    (coalesce((select sum(l.quantidade) from lancto l where l.empresa=t.empresa and (l.operacao=&apos;E&apos; or l.operacao=&apos;TE&apos;) and l.deposito=t.grid and l.data = t.data_metragem)+(select l.quantidade from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = (t.data_metragem::date -1)),0)-(select l.quantidade from lancto l where l.empresa=t.empresa and l.operacao=&apos;M&apos; and l.deposito=t.grid and l.data = t.data_metragem)) as saida
from
    (select 
        d.grid, 
             d.codigo as tanque, 
        p.nome as combustivel,
             lc.data as data_metragem, 
        d.empresa
    from 
        deposito d, 
        produto p, 
        lancto lc 
    where 
        d.produto=p.grid  
    and     d.empresa=$empresa  
    and     lc.produto = p.grid 
    and    lc.data between $data_ini and $data_fim
    UNION ALL
    select 
         d.grid, 
         d.codigo as tanque,
         p.nome as combustivel,
         s.data as data_metragem,
         d.empresa 
    from 
        (select (to_date($data_ini::date,&apos;YYYY-mm-01&apos;) + s) as data from generate_series(0,((to_date($data_fim::date + interval &apos;1 month&apos;,&apos;YYYY-mm-01&apos;)-1)-(to_date($data_ini::date,&apos;YYYY-mm-01&apos;))),1) s) s, 
        deposito d,
        produto p
    where 
        d.produto = p.grid
    and     d.empresa = $empresa) t 
order by 
    2,5" id="b1df05a834bc38ee330fd7113bb63555" ordem=" " titulo="Medição de Tanques Mensal"><apelidos>1  rel_posto_nome	tam=50
2  rel_data_hora	tam=18
3  empresa          	tam=50
5  tanque	        tam=3
6  combustivel		tam=20
7  data_metragem    	tam=10	fmt=data
8  medicao_ant		tam=3	fmt=%.0f
9  litragem_ant		tam=8 	fmt=%.01f
10 entrada 		tam=8	fmt=%.01f
11 estoque		tam=8	fmt=%.01f	expr=entrada+litragem_ant
12 medicao_atual	tam=3	fmt=%.0f
13 litragem_atual   	tam=8  	fmt=%.01f
14 saida		tam=8  	fmt=%.01f	expr=estoque-litragem_atual
15 bombas           	tam=8  	fmt=%.01f
16 diferenca        	tam=9  	fmt=%.01f	expr=saida-bombas
18 tot_ite_saida        tam=9  	fmt=%.01f	func=soma 	campo=saida	grupo=2
19 tot_ite_bomba        tam=9  	fmt=%.01f	func=soma 	campo=bombas	grupo=2
20 tot_ite_difer        tam=9  	fmt=%.01f	expr=tot_ite_saida-tot_ite_bomba
17 acumulado        	tam=9  	fmt=%.01f	expr=tot_ite_saida-tot_ite_bomba
21 tot_ite_acum         tam=9  	fmt=%.01f	expr=tot_ite_saida-tot_ite_bomba
22 tot_ger_saida        tam=9  	fmt=%.01f	func=soma 	campo=saida
23 tot_ger_bomba        tam=9  	fmt=%.01f	func=soma 	campo=bombas
24 tot_ger_difer        tam=9  	fmt=%.01f	expr=tot_ger_saida-tot_ger_bomba
25 tot_ger_acum         tam=9  	fmt=%.01f	expr=tot_ger_saida-tot_ger_bomba
30 data_ini		tam=10	fmt=data
31 data_fim		tam=10	fmt=data</apelidos><cab_pagina>
#1                                                                                              #2
----------------------------------------------------------------------------------------------------------------

                             MEDIÇÕES DE TANQUE - Período: #30        a #31

</cab_pagina>
<cab_grupo nome="1" quebra="empresa">
Empresa: #3
</cab_grupo>

<cab_grupo nome="2" quebra="tanque">
+--------------------------------------------------------------------------------------------------------------+
| Tanque: #5     #6                                                                                            |
+------------+----------------+---------+---------+----------------+---------+---------+-----------+-----------+
|            |    Inicial     |         |         |     Final      |   Saida |   Saida |           |           |
|   Data     | Med | Litragem | Entrada | Estoque | Med | Litragem |  Tanque |  Bombas | Diferença | Acumulado |
+------------+-----+----------+---------+---------+-----+----------+---------+---------+-----------+-----------+
</cab_grupo>
<detalhe>
| #7         | #8  | #9       |#10      |#11      | #12 | #13      |#14      |#15      | #16       | #17       |
</detalhe>
<rod_grupo nome="2">
+------------+-----+----------+---------+---------+-----+----------+---------+---------+-----------+-----------+
|                                         Total Geral do Tanque -&gt; |#18      |#19      | #20       | #21       |
+------------------------------------------------------------------+---------+---------+-----------+-----------+

</rod_grupo>
<rod_grupo nome="1">
+------------------------------------------------------------------+---------+---------+-----------+-----------+
|                                        Total Geral da Empresa -&gt; |#22      |#23      | #24       | #25       |
+------------------------------------------------------------------+---------+---------+-----------+-----------+
</rod_grupo>

<rod_pagina>
+------------+-----+----------+---------+---------+-----+----------+---------+---------+-----------+-----------+
</rod_pagina>
</layout></relatorio>