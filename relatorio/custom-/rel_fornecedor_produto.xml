<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-08-19 15:43:33" versao_xml="0.1"><tela titulo="Fornecedor por Produto">
  <quadro titulo="Parâmetros">
    <procura id="grupo" modelo="grupo_produto" titulo="Grupo Produto" />
    <procura id="subgrupo" modelo="subgrupo_produto" titulo="Subgrupo" />
    <procura id="produto" modelo="produto" titulo="Produto" />
    <campo id="dt_periodo" modelo="periodo" requerido="sim" tipo="data" titulo="Período" valor_padrao="SELECT to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
  </quadro>
</tela><ajuda>Relatorio de Fornecedor por Produto

Este relatório permite ver o Fornecedor por Produto</ajuda><layout dados="select 
    distinct pe.nome as fornecedor_nome,  
    p.nome as produto_nome,
    (select data from lancto where produto = l.produto and pessoa = l.pessoa and operacao =&apos;E&apos;
and data between $dt_periodo_ini and $dt_periodo_fim order by data desc limit 1) as data_ult_compra,    
    (select quantidade from lancto where produto = l.produto and pessoa = l.pessoa and operacao =&apos;E&apos;
and data between $dt_periodo_ini and $dt_periodo_fim order by data desc limit 1) as qtd_ult_compra,     
    (select valor from lancto where produto = l.produto and pessoa = l.pessoa and operacao =&apos;E&apos;
and data between $dt_periodo_ini and $dt_periodo_fim order by data desc limit 1) as valor_ult_compra,
    (select preco_unit from lancto where produto = l.produto and pessoa = l.pessoa and operacao =&apos;E&apos;
and data between $dt_periodo_ini and $dt_periodo_fim order by data desc limit 1) as preco_ult_compra,
    p.preco_unit as preco_venda
from 
    lancto l 
       join pessoa pe on (l.pessoa=pe.grid)
       join produto p on (l.produto = p.grid)
where 
    l.operacao=&apos;E&apos; 
and     l.data between $dt_periodo_ini and $dt_periodo_fim
and     (case when $grupo is NULL then true else p.grupo = $grupo end)
and         (case when $subgrupo is NULL then true else p.subgrupo = $subgrupo end)
and         (case when $produto is NULL then true else p.grid = $produto end)
order by 
    p.nome" id="88d5c6fc628f2093ed87e58bae26d38a" ordem="" titulo="Fornecedor por Produto"><apelidos>1  rel_posto_nome    	tam=60
2  rel_data_hora 	tam=18
3  produto_nome		tam=30
4  estoque		tam=9  	
5  preco_venda		tam=7   fmt=%.2f
6  fornecedor_nome	tam=30  
7  data_ult_compra	tam=15	fmt=data	alinha=centro
8  preco_ult_compra	tam=12	fmt=%.04f
9  qtd_ult_compra	tam=10  fmt=%d
10 valor_ult_compra	tam=8   fmt=%.2f</apelidos><cab_pagina>
#1                                                                       #2
------------------------------------------------------------------------------------------
 
                                    FORNECEDOR POR PRODUTO

</cab_pagina>

<cab_grupo nome="1" quebra="produto_nome">
Produto:#3                                                           Preco Venda:#5
+-------------------------------+-----------------+--------------+------------+----------+
| Fornecedor                    | Data Ult Compra | Ultimo Custo | Quantidade |    Valor |            
+-------------------------------+-----------------+--------------+------------+----------+
</cab_grupo>

<detalhe>
| #6                            | #7              | #8           | #9         | #10      |
</detalhe>

<rod_grupo nome="1">
+-------------------------------+-----------------+--------------+------------+----------+

</rod_grupo>

<rod_pagina>
+-------------------------------+-----------------+--------------+------------+----------+
</rod_pagina>
</layout></relatorio>