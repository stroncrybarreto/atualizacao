<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-11-27 10:24:58" versao_xml="0.1"><tela titulo="Valores recebidos de outro posto">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" requerido="sim" titulo="Empresa" valor_padrao="select empresa from empresa_local" />
    <procura id="pessoa" modelo="pessoa" titulo="Cliente" />
    <campo id="data" modelo="periodo" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <check id="baixa" titulo="Mostrar apenas baixas realizadas no caixa" />
  </quadro>
</tela><ajuda /><layout dados="select
    empresa_nome,
    sum(valor_recebido) as valor_recebido,
    sum(valor_emprestimo) as valor_emprestimo
from
    (select 
        m1.empresa, 
        p.nome_reduzido as empresa_nome, 
        (m1.valor+(case when not (select m.valor from movto m where m.grid=m1.child and m.conta_debitar like &apos;3.4.%&apos;) is null then (select m.valor from movto m where m.grid=m1.child and m.conta_debitar like &apos;3.4.%&apos;) else 0 end)) as valor_recebido, 
        (select sum(t2.valor) from (select m.empresa, sum(m.valor) as valor from movto m1 join movto_map mm on (m1.grid=mm.child) join movto m on (mm.parent=m.grid) where m.child != 0 and m1.data between $data_ini and $data_fim and m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) and (case when $pessoa is null then true else m1.pessoa = $pessoa end) and (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) and m1.empresa = $empresa group by m.empresa) t2 where t2.empresa=m1.empresa) as valor_baixado,
        (select sum(rec.valor) from (select m1.grid as baixa, m.empresa, m.valor from movto m1 join movto_map mm on (m1.grid=mm.child) join movto m on (mm.parent=m.grid) where m.child != 0 and m1.data between $data_ini and $data_fim and m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) and (case when $pessoa is null then true else m1.pessoa = $pessoa end) and (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) and m1.empresa = $empresa) rec where rec.empresa != m1.empresa and m1.grid=rec.baixa) as valor_emprestimo
    from 
        movto m1 
           join pessoa p on (p.grid=m1.empresa)
    where 
        m1.data between $data_ini and $data_fim 
    and     m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) 
    and     (case when $pessoa is null then true else m1.pessoa = $pessoa end)
    and     (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) 
    and     m1.empresa = $empresa) t
group by
    empresa_nome
order by
    empresa_nome" id="43e47970e0d69a67a501b53eba39c311" ordem="" titulo="Sintético"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
3  empresa_nome         tam=45  alinha=esquerda
4  valor_recebido       tam=21  fmt=%.02f   alinha=direita
5  valor_emprestimo     tam=21  fmt=%.02f   alinha=direita</apelidos><cab_pagina>
#1                                                                                              #2
----------------------------------------------------------------------------------------------------------------

   V A L O R E S   R E C E B I D O S   E M   U M   P O S T O   R E F E R E N T E   A   O U T R O   P O S T O

 
+--------------------------------------------------------------+-----------------------+-----------------------+
| Empresa                                                      |  Valor Recebido Total | Valor de 'Empréstimo' |
+--------------------------------------------------------------+-----------------------+-----------------------+
</cab_pagina>

<detalhe>
| #3                                                           | #4                    | #5                    |
</detalhe>
 
<rod_pagina>
+--------------------------------------------------------------+-----------------------+-----------------------+
</rod_pagina>
 
<rod_relat>
+--------------------------------------------------------------+-----------------------+-----------------------+
</rod_relat></layout><layout dados="select
    empresa_nome,
    data,
    pessoa_nome(pessoa) as cliente_nome,
    documento,
    motivo_nome,
    sum(valor_recebido) as valor_recebido,
    sum(valor_emprestimo) as valor_emprestimo
from
    (select 
        m1.*, 
        p.nome_reduzido as empresa_nome, 
        mm.nome as motivo_nome,
        (m1.valor+(case when not (select m.valor from movto m where m.grid=m1.child and m.conta_debitar like &apos;3.4.%&apos;) is null then (select m.valor from movto m where m.grid=m1.child and m.conta_debitar like &apos;3.4.%&apos;) else 0 end)) as valor_recebido, 
        (select sum(t2.valor) from (select m.empresa, sum(m.valor) as valor from movto m1 join movto_map mm on (m1.grid=mm.child) join movto m on (mm.parent=m.grid) where m.child != 0 and m1.data between $data_ini and $data_fim and m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) and (case when $pessoa is null then true else m1.pessoa = $pessoa end) and (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) and m1.empresa = $empresa group by m.empresa) t2 where t2.empresa=m1.empresa) as valor_baixado,
        (select sum(rec.valor) from (select m1.grid as baixa, m.empresa, m.valor from movto m1 join movto_map mm on (m1.grid=mm.child) join movto m on (mm.parent=m.grid) where m.child != 0 and m1.data between $data_ini and $data_fim and m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) and (case when $pessoa is null then true else m1.pessoa = $pessoa end) and (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) and m1.empresa = $empresa) rec where rec.empresa != m1.empresa and m1.grid=rec.baixa) as valor_emprestimo
    from 
        movto m1 
           join pessoa p on (p.grid=m1.empresa)
           join motivo_movto mm on (m1.motivo = mm.grid)
    where 
        m1.data between $data_ini and $data_fim 
    and     m1.conta_creditar like (select conta from conta_config where chave = &apos;VALORES A RECEBER&apos;)||&apos;%&apos; and (case when $baixa = 1 then m1.conta_debitar like (select conta from conta_config where chave = &apos;PONTOS DE VENDA&apos;)||&apos;%&apos; else true end) 
    and     (case when $pessoa is null then true else m1.pessoa = $pessoa end)
    and     (m1.conta_debitar like &apos;1.1.%&apos; or m1.conta_debitar like &apos;1.2.%&apos;) 
    and     m1.empresa = $empresa) t
group by
    empresa_nome,
    data,
    documento,
    motivo_nome,
    pessoa
order by
    1, 2, 3, 4
    " id="86f1188083ef9fc95543be0fcb2df28c" ordem="" titulo="Analítico"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
4  data                 tam=10  fmt=data
5  documento            tam=9
6  motivo_nome          tam=30
7  cliente_nome         tam=25
10 empresa_nome         tam=90
13 valor_recebido       tam=16  fmt=%.02f   alinha=direita
14 valor_emprestimo     tam=16  fmt=%.02f   alinha=direita
15 total_recebido       tam=16  fmt=%.02f   alinha=direita	func=soma   campo=valor_recebido 	grupo=1
16 total_emprestimo     tam=16  fmt=%.02f   alinha=direita	func=soma   campo=valor_emprestimo 	grupo=1</apelidos><cab_pagina>
#1                                                                                                           #2
-----------------------------------------------------------------------------------------------------------------------------

        V A L O R E S   R E C E B I D O S   E M   U M   P O S T O   R E F E R E N T E   A   O U T R O   P O S T O
                                                  A N A L Í T I C O


</cab_pagina>
 
<cab_grupo nome="1" quebra="empresa_nome">
 
+---------------------------------------------------------------------------------------------------------------------------+
| Empresa: #10                                                                                                              |
+------------+-----------+--------------------------------+---------------------------+------------------+------------------+
| Data       | Documento | Motivo                         | Cliente                   |  Valor Recebido  | Valor Empréstimo |
+------------+-----------+--------------------------------+---------------------------+------------------+------------------+
</cab_grupo>

<detalhe>
| #4         | #5        | #6                             | #7                        | #13              | #14              |
</detalhe>

<rod_grupo nome="1">
+------------+-----------+--------------------------------+---------------------------+------------------+------------------+
|                                                                               TOTAL | #15              | #16              |
+-------------------------------------------------------------------------------------+------------------+------------------+
</rod_grupo>
 
<rod_pagina>
</rod_pagina>
 
<rod_relat>
</rod_relat>
</layout></relatorio>