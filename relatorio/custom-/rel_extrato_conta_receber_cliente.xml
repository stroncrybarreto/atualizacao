<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-10-28 14:28:29" versao_xml="0.1"><tela titulo="Extrato de contas a receber por cliente">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" valor_padrao="select empresa from empresa_local" />
    <procura id="grupo" modelo="grupo_pessoa" titulo="Grupo Cliente" />
    <procura id="cliente" modelo="pessoa" titulo="Cliente" />
    <procura id="conta" modelo="conta" titulo="Conta" />
    <campo id="data" modelo="periodo" titulo="Período" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <selecao id="exibir" origem="values (1,&apos;Todas&apos;),(2,&apos;Quitadas&apos;),(3,&apos;Em aberto&apos;),(4,&apos;Pagamentos com atraso&apos;)" requerido="sim" titulo="Exibir" />
  </quadro>
</tela><ajuda /><layout dados="select 
    t.*
from
    (select 
        to_char(m.data,&apos;dd/mm/yy&apos;) as data_emissao, 
        to_char(m.vencto,&apos;dd/mm/yy&apos;) as data_vencto, 
        c.codigo as conta_codigo, 
        p.nome as pessoa_nome, 
        mm.nome as motivo_nome, 
        c.nome as conta_nome, 
        m.valor, 
        m.documento, 
        coalesce(mi.info::float,0) as valor_desconto, 
        coalesce((select valor from movto where grid in (select child from movto_map where parent=m.grid) and motivo=&apos;40877&apos; limit 1),0) as valor_mora, 
        coalesce((select valor from movto where grid in (select child from movto_map where parent=m.grid) and motivo=&apos;40873&apos; limit 1),0) as valor_juros,
        coalesce((select valor from movto where grid = (select child from movto_map where parent=m.grid limit 1)),0) as valor_pago,
        to_char((select vencto from movto where grid = (select child from movto_map where parent=m.grid limit 1)),&apos;dd/mm/yy&apos;) as data_pgto
    from 
        movto m 
           join motivo_movto mm on (m.motivo=mm.grid) 
           join pessoa p on (p.grid=m.pessoa) 
           join conta c on (m.conta_debitar=c.codigo) 
           left join movto_info mi on (m.grid=mi.movto and mi.tipo=&apos;desconto&apos;) 
    where 
        c.tipo_conta_receber 
    and     (case when $empresa is null then true else m.empresa = $empresa end) 
    and     (case when $conta is null then true else m.conta_debitar = $conta end)
    and     (case when $cliente is null then true else m.pessoa = $cliente end)
    and     (case when $grupo is null then true else p.grupo = $grupo end)
    and     m.data between $data_ini and $data_fim) t
where
    (case when $exibir = 2 then data_pgto is not null when $exibir = 3 then data_pgto is null when $exibir = 4 then data_pgto &gt; data_vencto else true end)
order by
    pessoa_nome,
    motivo_nome,
    data_emissao,
    documento" id="6f42d177f05347f0efdca912dd54c7d6" ordem="" titulo="cliente"><apelidos>1  rel_posto_nome	tam=60
2  rel_data_hora	tam=18
7  pessoa_nome		tam=100
8  conta_codigo		tam=10	
9  documento		tam=9
10 motivo_nome		tam=22
11 data_emissao		tam=8
12 data_vencto		tam=8
13 data_pgto		tam=8
14 valor		tam=10	fmt=%0.2f
15 valor_desconto	tam=6	fmt=%0.2f
16 valor_mora           tam=6	fmt=%0.2f
17 valor_pago		tam=9	fmt=%0.2f
18 subtotal_valor	tam=10	fmt=%0.2f	func=soma	campo=valor		grupo=1
19 subtotal_desc	tam=6	fmt=%0.2f	func=soma	campo=valor_desconto	grupo=1
20 subtotal_mora	tam=6	fmt=%0.2f	func=soma	campo=valor_mora	grupo=1
21 subtotal_pago	tam=9	fmt=%0.2f	func=soma	campo=valor_pago	grupo=1
22 total_valor		tam=10	fmt=%0.2f	func=soma	campo=valor		
23 total_desc		tam=6	fmt=%0.2f	func=soma	campo=valor_desconto	
24 total_mora		tam=6	fmt=%0.2f	func=soma	campo=valor_mora	
25 total_pago		tam=9	fmt=%0.2f	func=soma	campo=valor_pago	</apelidos><cab_pagina>
#1                                                                                                          #2              
----------------------------------------------------------------------------------------------------------------------------

                        E X T R A T O   D E   C O N T A S   A   R E C E B E R   P O R   C L I E N T E


</cab_pagina>


<cab_grupo nome="1" quebra="pessoa_nome">
+--------------------------------------------------------------------------------------------------------------------------+
| Cliente: #7                                                                                                              |
+-----------+-----------+------------------------+----------+----------+----------+-----------+--------+--------+----------+
| Conta     | Documento | Historico              | Dt Emis. | Dt Venc. | Dt Pgto. |     Valor |   Desc |   Mora |  V. Pago |
+-----------+-----------+------------------------+----------+----------+----------+-----------+--------+--------+----------+
</cab_grupo>

<detalhe>
| #8        | #9        | #10                    | #11      | #12      | #13      |#14        | #15    | #16    |#17       |
</detalhe>

<rod_grupo nome="1">
+-----------+-----------+------------------------+----------+----------+----------+-----------+--------+--------+----------+
| Total                                                                           |#18        | #19    | #20    |#21       |
+---------------------------------------------------------------------------------+-----------+--------+--------+----------+

</rod_grupo>

<rod_pagina>
+-----------+-----------+------------------------+----------+----------+----------+-----------+--------+--------+----------+
</rod_pagina>

<rod_relat>
+---------------------------------------------------------------------------------+-----------+--------+--------+----------+
| Total                                                                           |#22        | #23    | #24    |#25       |
+---------------------------------------------------------------------------------+-----------+--------+--------+----------+
</rod_relat>
</layout></relatorio>