<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-09 17:26:24" versao_xml="0.1"><tela titulo="Movimentação de Produtos">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" />
    <caixa>
      <campo id="data" modelo="periodo" requerido="sim" tipo="data" titulo="Período" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
      <selecao id="operacao" origem="VALUES (&apos;&apos;,&apos;TODAS&apos;), (&apos;A&apos;,&apos;AFERICAO&apos;), (&apos;C&apos;,&apos;CONSUMO&apos;), (&apos;E&apos;,&apos;ENTRADA&apos;), (&apos;I&apos;,&apos;INVENTARIO&apos;), (&apos;P&apos;,&apos;PERDA&apos;), (&apos;M&apos;,&apos;MEDICAO&apos;), (&apos;S&apos;,&apos;SOBRA&apos;), (&apos;T&apos;,&apos;TRANSFERENCIA&apos;), (&apos;V&apos;, &apos;VENDA&apos;)" requerido="sim" titulo="Operação" />
    </caixa>
    <procura id="grupo" modelo="grupo_produto" titulo="Grupo" />
    <procura condicao="(grupo = $grupo or $grupo is null)" id="subgrupo" modelo="subgrupo_produto" titulo="Subgrupo" />
    <procura condicao="((grupo = $grupo or $grupo is null) and (subgrupo = $subgrupo or $subgrupo is null))" id="produto" modelo="produto" titulo="Produto" />
    <procura condicao="(empresa = $empresa or $empresa is null)" id="deposito" modelo="deposito" titulo="Deposito" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Movimentação de Produtos&lt;/b&gt;&lt;/big&gt;

Este relatório permite ver as Movimentação de Produtos</ajuda><layout dados="select 
    l.empresa||&apos; - &apos;||pessoa_nome(l.empresa) as empresa_cod_nome, 
    p.nome as produto_nome, 
    d.codigo||&apos; - &apos;||d.nome as deposito_cod_nome, 
    l.data, 
    l.turno,
    l.operacao,
    l.documento,
    p.codigo as produto_codigo, 
    p.grupo, 
    p.tipo,                   
    (case when l.operacao in (&apos;V&apos;,&apos;C&apos;,&apos;P&apos;,&apos;TS&apos;,&apos;DF&apos;,&apos;B&apos;) then l.quantidade end) as saida, 
    (case when l.operacao in (&apos;E&apos;,&apos;S&apos;,&apos;TE&apos;,&apos;DC&apos;) then l.quantidade end) as entrada,      
    (case when l.operacao in (&apos;M&apos;) then l.quantidade end) as medicao,     
    produto_estoque_f(NULL,d.grid,p.grid,l.data-1) as estoque_ant, 
    (case when l.operacao in (&apos;M&apos;) then l.quantidade else (produto_estoque_f(NULL,d.grid,p.grid,l.data-1) - (select coalesce(sum(quantidade),0) from lancto where data = l.data and hora &lt;= l.hora and produto=p.grid and deposito=d.grid and operacao &lt;&gt; &apos;M&apos; and operacao in (&apos;V&apos;,&apos;C&apos;,&apos;P&apos;,&apos;TS&apos;,&apos;DF&apos;,&apos;B&apos;)) + (select coalesce(sum(quantidade),0) from lancto where data = l.data and hora &lt;= l.hora and produto=p.grid and deposito=d.grid and operacao &lt;&gt; &apos;M&apos; and operacao in (&apos;E&apos;,&apos;S&apos;,&apos;TE&apos;,&apos;DC&apos;)))end) as estoque,    
    ((case when l.operacao in (&apos;M&apos;) then l.quantidade end) - produto_estoque_f(NULL,d.grid,p.grid,l.data-1)) as diferenca 
from 
    produto p 
         join deposito d on ((d.produto = p.grid) or (d.grid in (select deposito from deposito_grupo_produto where grupo=p.grupo))) 
         join lancto l on (l.produto = p.grid and l.deposito = d.grid) 
where 
    (case when $grupo is null then true else p.grupo = $grupo end)  
and     (case when $subgrupo is null then true else p.subgrupo = $subgrupo end)  
and     (case when $produto is null then true else p.grid = $produto end)  
and     (case when $empresa is null then true else l.empresa = $empresa end)  
and     l.data between $data_ini and $data_fim 
order by 
    1,2,3,4,5,6,7" id="b1df05a834bc38ee330fd7113bb63555" ordem=" " titulo="Movimentação de Produtos"><apelidos>1  rel_posto_nome	tam=60
2  rel_data_hora        tam=18
4  titulo2		tam=99			alinha=centro
5  empresa_cod_nome	tam=50
6  produto_nome		tam=50
7  deposito_cod_nome	tam=50
8  data_ini		tam=10	fmt=data
9  estoque_ant		tam=9	fmt=%.03f
10 data			tam=10 	fmt=data
11 turno		tam=5			alinha=centro
12 operacao	        tam=3
13 documento		tam=10
14 entrada		tam=11	fmt=%.03f	nulo
15 saida		tam=11	fmt=%.03f	nulo
16 medicao		tam=9	fmt=%.03f	nulo
17 diferenca		tam=9	fmt=%.03f	nulo
18 estoque		tam=9	fmt=%.03f
19 total_entrada	tam=11	fmt=%.03f	func=soma	campo=entrada	grupo=2
20 total_saida		tam=11	fmt=%.03f	func=soma	campo=saida	grupo=2
21 total_diferenca	tam=9	fmt=%.03f	func=soma	campo=diferenca	grupo=2</apelidos><cab_pagina>
#1                                                                                     #2
-------------------------------------------------------------------------------------------------------

                                 MOVIMENTAÇÂO DE PRODUTOS DETALHADA
#4

</cab_pagina>

<cab_grupo nome="1" quebra="empresa_cod_nome" quebra_pagina="1" repeticao="0">
EMPRESA: #5
</cab_grupo>

<cab_grupo nome="2" quebra="empresa_cod_nome,produto_nome,deposito_cod_nome">
+-----------------------------------------------------------------------------------------------------+
| Produto.: #6                                                                                        |
| Deposito: #7                                                                                        |
+-----------------------------------------------------------------------------------------+-----------+
| Estoque anterior a #8                                                                   | #9        |
+------------+-------+----+-----------+-------------+-------------+-----------+-----------+-----------+
|    Data    | Turno | Op | Documento |     Entrada |       Saida |   Medicao | Diferenca |   Estoque |
+------------+-------+----+-----------+-------------+-------------+-----------+-----------+-----------+
</cab_grupo>

<detalhe>
| #10        | #11   | #12| #13       | #14         | #15         | #16       | #17       | #18       |
</detalhe>

<rod_grupo nome="2">
+------------+-------+----+-----------+-------------+-------------+-----------+-----------+-----------+
| Total no período        |           | #19         | #20         |           | #21       | #18       |
+-------------------------+-----------+-------------+-------------+-----------+-----------+-----------+

</rod_grupo>

<rod_grupo nome="1">
</rod_grupo>

<rod_pagina>
+------------+-------+----+-----------+-------------+-------------+-----------+-----------+-----------+
</rod_pagina>
</layout></relatorio>