<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-09-08 14:54:10" versao_xml="0.1"><tela titulo="Livro Caixa">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" valor_padrao="select grid from empresa_local" />
    <procura condicao=" livro_caixa=&apos;t&apos;" id="conta" modelo="conta" titulo="Conta" />
    <caixa>
      <campo id="data" modelo="periodo" titulo="Período" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
      <campo id="turno" tipo="inteiro" titulo="Turno" />
    </caixa>
    <procura id="pessoa" modelo="pessoa" titulo="Pessoa" />
  </quadro>
  <quadro titulo="Opções">
    <check id="exibir_conta_filha" titulo="Exibir movimento de contas filhas" valor_padrao="select true" />
    <check id="exibir_conta_ativo" titulo="Exibir apenas movimentação de contas do ATIVO e PASSIVO" />
    <selecao id="lancamento" origem="values (1,&apos;Todos os lancamentos&apos;), (2,&apos;Somente entrada&apos;), (3,&apos;Somente saida&apos;)" requerido="sim" />
  </quadro>
</tela><ajuda>&lt;big&gt;&lt;b&gt;Relatorio de Livro Caixa/b&gt;&lt;/big&gt;

Este relatório permite ver o Livro Caixa</ajuda><layout dados="select      pessoa_nome(m.empresa) as empresa_nome,     c.nome as conta_nome,     c.codigo as conta_codigo,         m.data as movto_data,     m.turno as movto_turno,     m.seq as movto_seq,     m.documento as movto_documento,     mm.nome as motivo_nome,     pessoa_nome_f(m.pessoa) as pessoa_nome,     m.obs as movto_obs,     coalesce((select sum(valor) from movto where grid=m.grid and conta_debitar = c.codigo),0) as movto_entrada,     coalesce((select sum(valor) from movto where grid=m.grid and conta_creditar = c.codigo),0) as movto_saida,     conta_saldo_empresa(c.codigo, $data_ini::date, m.empresa) as movto_saldo_ant from      movto m         join motivo_movto mm on (m.motivo=mm.grid)        join conta c on (m.conta_debitar = c.codigo or m.conta_creditar = c.codigo)  where      (case when $exibir_conta_filha = 0 then (case when $conta is null then true else c.codigo = $conta end) else (case when $conta is null then true else c.codigo like $conta||&apos;%&apos; end) end) and     m.data between $data_ini and $data_fim and     (case when $pessoa is null then true else m.pessoa = $pessoa end) and     (case when $empresa is null then true else m.empresa = $empresa end) and     (case when $turno is null then true else m.turno = $turno end) and     c.livro_caixa  and     (case when $exibir_conta_ativo = 0 then true else (m.conta_debitar like &apos;1.%&apos; or m.conta_creditar like &apos;1.%&apos; or m.conta_debitar like &apos;2.%&apos; or m.conta_creditar like &apos;2.%&apos;) end) and     (case when $lancamento = 1 then true when $lancamento = 2 then m.grid in (select grid from movto where grid=m.grid and conta_debitar = c.codigo) else m.grid in (select grid from movto where grid=m.grid and conta_creditar = c.codigo) end) order by      1, 2, 3,     m.data,      m.turno,      m.hora" id="4926af86b780ec1532e27002f617f068" ordem=" " titulo="Analítico por Conta"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
3  data_ini             tam=10 fmt=data
4  data_fim             tam=10 fmt=data
5  conta_nome           tam=40
7  movto_data           tam=10 fmt=data
8  movto_turno          tam=2  fmt=%02d
9  movto_seq            tam=3  fmt=%03d
10 motivo_nome          tam=17
11 movto_entrada        tam=10 fmt=%.02f
12 movto_saida          tam=10 fmt=%.02f
14 pessoa_nome          tam=14
15 movto_total_entrada  tam=10 fmt=%.02f	func=soma	campo=movto_entrada	grupo=2
16 movto_total_saida    tam=10 fmt=%.02f	func=soma	campo=movto_saida	grupo=2
17 movto_saldo_ant      tam=14 fmt=%.02f
13 movto_saldo          tam=14 fmt=%.02f	expr=((movto_total_entrada-movto_total_saida)+movto_saldo_ant)
18 movto_documento      tam=10
19 total_entrada	tam=10 fmt=%.02f	func=soma	campo=movto_entrada
20 total_saida          tam=10 fmt=%.02f	func=soma	campo=movto_saida
21 movto_obs	        tam=14
22 empresa_nome		tam=60</apelidos><cab_pagina>
#1                                                                                                        #2
----------------------------------------------------------------------------------------------------------------------------
   

LIVRO CAIXA
Período de #3         a #4

</cab_pagina>
<cab_grupo nome="2" quebra="empresa_nome,conta_nome">

+--------------------------------------------------------------------------------------------------------------------------+
| Conta: #5                                                                                                      Analitico |
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
| Data      |Tur | Seq | Documento | Motivo           | Entrada  | Saida    | Saldo        | Responsavel   | Obs           |
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
</cab_grupo>
<cab_grupo nome="3" quebra="conta_nome" repeticao="0">
| Saldo inicial                                                             |#17           |               |               |
</cab_grupo>
<detalhe>
| #7        | #8 | #9  | #18       | #10              |#11       |#12       |#13           | #14           | #21           |
</detalhe>
<rod_grupo nome="3">
</rod_grupo>
<rod_grupo nome="2">
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
| TOTAL                                               |#15       |#16       |#13           |               |               |
+-----------------------------------------------------+----------+----------+--------------+---------------+---------------+
</rod_grupo>
<rod_pagina>
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
</rod_pagina>
<rod_relat>

+-----------------------------------------------------+----------+----------+--------------+---------------+---------------+
| TOTAL GERAL                                         |#19       |#20       |                              |               |
+-----------------------------------------------------+----------+----------+--------------+---------------+---------------+
</rod_relat>
</layout><layout dados="select      pessoa_nome(m.empresa) as empresa_nome,     c.nome as conta_nome,     c.codigo as conta_codigo,     to_char(m.data,&apos;mm&apos;) as movto_mes,     (case when to_char(m.data,&apos;mm&apos;) = &apos;01&apos; then &apos;JANEIRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;02&apos; then &apos;FEVEREIRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;03&apos; then &apos;MARÇO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;04&apos; then &apos;ABRIL&apos; when to_char(m.data,&apos;mm&apos;) = &apos;05&apos; then &apos;MAIO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;06&apos; then &apos;JUNHO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;07&apos; then &apos;JULHO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;08&apos; then &apos;AGOSTO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;09&apos; then &apos;SETEMBRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;10&apos; then &apos;OUTUBRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;11&apos; then &apos;NOVEMBRO&apos; else &apos;DEZEMBRO&apos; end) as mes_nome,         m.data as movto_data,     m.turno as movto_turno,     m.seq as movto_seq,     m.documento as movto_documento,     mm.nome as motivo_nome,     m.valor as movto_valor,     pessoa_nome_f(m.pessoa) as pessoa_nome,     m.conta_debitar,     m.obs as movto_obs,     m.lote as movto_lote,     m.conta_creditar,     coalesce((select sum(valor) from movto where grid=m.grid and conta_debitar = c.codigo),0) as movto_entrada,     coalesce((select sum(valor) from movto where grid=m.grid and conta_creditar = c.codigo),0) as movto_saida,     conta_saldo_empresa(c.codigo, (case when to_char(m.data,&apos;mm&apos;)=to_char($data_ini::date,&apos;mm&apos;) then $data_ini else to_char(m.data, &apos;yyyy-mm-01&apos;) end)::date, m.empresa) as movto_saldo_ant from      movto m         join motivo_movto mm on (m.motivo=mm.grid)        join conta c on (m.conta_debitar = c.codigo or m.conta_creditar = c.codigo)  where      (case when $exibir_conta_filha = 0 then (case when $conta is null then true else c.codigo = $conta end) else (case when $conta is null then true else c.codigo like $conta end) end) and     m.data between $data_ini and $data_fim and     (case when $pessoa is null then true else m.pessoa = $pessoa end) and     (case when $empresa is null then true else m.empresa = $empresa end) and     (case when $turno is null then true else m.turno = $turno end) and     c.livro_caixa  and     (case when $exibir_conta_ativo = 0 then true else (m.conta_debitar like &apos;1.%&apos; or m.conta_creditar like &apos;1.%&apos; or m.conta_debitar like &apos;2.%&apos; or m.conta_creditar like &apos;2.%&apos;) end) and     (case when $lancamento = 1 then true when $lancamento = 2 then m.grid in (select grid from movto where grid=m.grid and conta_debitar = c.codigo) else m.grid in (select grid from movto where grid=m.grid and conta_creditar = c.codigo) end) order by      1, 2, 3,     m.data,      m.turno,      m.hora" id="3d55cb1af44f23053e337e90270d01e4" ordem="" titulo="Analítico por Mês"><apelidos>1  rel_posto_nome       	tam=60
2  rel_data_hora        	tam=18
3  data_ini             	tam=10 	fmt=data
4  data_fim             	tam=10 	fmt=data
5  conta_nome           	tam=40
6  conta_saldo          	tam=10 	fmt=%.02f
7  movto_data           	tam=10 	fmt=data
8  movto_turno          	tam=2  	fmt=%02d
9  movto_seq            	tam=3  	fmt=%03d
10 motivo_nome          	tam=17
11 movto_entrada        	tam=10 	fmt=%.02f
12 movto_saida          	tam=10 	fmt=%.02f
13 movto_saldo          	tam=14 fmt=%.02f	expr=((movto_total_mes_entrada-movto_total_mes_saida)+movto_saldo_ant)
14 pessoa_nome          	tam=14
15 movto_total_entrada  	tam=10 	fmt=%.02f	func=soma	campo=movto_entrada	grupo=2
16 movto_total_saida    	tam=10 	fmt=%.02f	func=soma	campo=movto_saida	grupo=2
17 movto_saldo_ant      	tam=14 	fmt=%.02f
18 movto_documento      	tam=10
19 total_entrada		tam=10 	fmt=%.02f	func=soma	campo=movto_entrada
20 total_saida          	tam=10 	fmt=%.02f	func=soma	campo=movto_saida
21 movto_obs	        	tam=14
22 movto_total_mes_entrada	tam=10 	fmt=%.02f	func=soma	campo=movto_entrada	grupo=4
23 movto_total_mes_saida    	tam=10 	fmt=%.02f	func=soma	campo=movto_saida	grupo=4
25 mes_nome			tam=99	
26 movto_mes			tam=3</apelidos><cab_pagina>
#1                                                                                                        #2
----------------------------------------------------------------------------------------------------------------------------
   

LIVRO CAIXA
Período de #3         a #4

</cab_pagina>
<cab_grupo nome="2" quebra="empresa_nome,conta_nome">
+--------------------------------------------------------------------------------------------------------------------------+
| Conta: #5                                                                                                      Analitico |
+--------------------------------------------------------------------------------------------------------------------------+
</cab_grupo>
<cab_grupo nome="4" quebra="empresa_nome,conta_nome,movto_mes">
+--------------------------------------------------------------------------------------------------------------------------+
| Mês: #25                                                                                                                 |
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
| Data      |Tur | Seq | Documento | Motivo           | Entrada  | Saida    | Saldo        | Responsavel   | Obs           |
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
</cab_grupo>
<cab_grupo nome="3" quebra="empresa_nome,conta_nome,movto_mes" repeticao="0">
| Saldo inicial                                                             |#17           |               |               |
</cab_grupo>
<detalhe>
| #7        | #8 | #9  | #18       | #10              |#11       |#12       |#13           | #14           | #21           |
</detalhe>
<rod_grupo nome="3">
</rod_grupo>
<rod_grupo nome="4">
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
| TOTAL                                               |#15       |#16       |#13           |               |               |
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
</rod_grupo>
<rod_grupo nome="2">
</rod_grupo>
<rod_pagina>
+-----------+----+-----+-----------+------------------+----------+----------+--------------+---------------+---------------+
</rod_pagina>
<rod_relat>

+-----------------------------------------------------+----------+----------+--------------+---------------+---------------+
| TOTAL GERAL                                         |#19       |#20       |                              |               |
+-----------------------------------------------------+----------+----------+--------------+---------------+---------------+
</rod_relat>
</layout><layout dados="select      pessoa_nome(m.empresa) as empresa_nome,     c.nome as conta_nome,     c.codigo as conta_codigo,     m.data as movto_data,     m.turno as movto_turno,     m.seq as movto_seq,     m.documento as movto_documento,     mm.nome as motivo_nome,     m.valor as movto_valor,     pessoa_nome_f(m.pessoa) as pessoa_nome,     m.conta_debitar,     m.obs as movto_obs,     m.lote as movto_lote,     m.conta_creditar,     coalesce((select sum(valor) from movto where grid=m.grid and conta_debitar = c.codigo),0) as movto_entrada,     coalesce((select sum(valor) from movto where grid=m.grid and conta_creditar = c.codigo),0) as movto_saida,     conta_saldo_empresa(c.codigo, $data_ini::date, m.empresa) as movto_saldo_ant from      movto m         join motivo_movto mm on (m.motivo=mm.grid)        join conta c on (m.conta_debitar = c.codigo or m.conta_creditar = c.codigo)  where      (case when $exibir_conta_filha = 0 then (case when $conta is null then true else c.codigo = $conta end) else (case when $conta is null then true else c.codigo like $conta end) end) and     m.data between $data_ini and $data_fim and     (case when $pessoa is null then true else m.pessoa = $pessoa end) and     (case when $empresa is null then true else m.empresa = $empresa end) and     (case when $turno is null then true else m.turno = $turno end) and     c.livro_caixa  and     (case when $exibir_conta_ativo = 0 then true else (m.conta_debitar like &apos;1.%&apos; or m.conta_creditar like &apos;1.%&apos; or m.conta_debitar like &apos;2.%&apos; or m.conta_creditar like &apos;2.%&apos;) end) and     (case when $lancamento = 1 then true when $lancamento = 2 then m.grid in (select grid from movto where grid=m.grid and conta_debitar = c.codigo) else m.grid in (select grid from movto where grid=m.grid and conta_creditar = c.codigo) end) order by      1, 2, 3,     m.data,      m.turno,      m.hora" id="d72b2125ca8bf030c018fcd396ad0ec8" ordem="" titulo="Analítico por Data"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
3  data_ini             tam=10 fmt=data
4  data_fim             tam=10 fmt=data
5  conta_nome           tam=17
6  conta_saldo          tam=10 fmt=%.02f
7  movto_data           tam=10 fmt=data
8  movto_turno          tam=2  fmt=%02d
9  movto_seq            tam=3  fmt=%03d
10 motivo_nome          tam=18
11 movto_entrada        tam=10 fmt=%.02f
12 movto_saida          tam=10 fmt=%.02f
13 movto_saldo          tam=14 fmt=%.02f	expr=((movto_total_entrada-movto_total_saida)+movto_saldo_ant)
14 pessoa_nome          tam=15
15 movto_total_entrada  tam=10 	fmt=%.02f	func=soma	campo=movto_entrada	grupo=3
16 movto_total_saida    tam=10 	fmt=%.02f	func=soma	campo=movto_saida	grupo=3
17 movto_saldo_ant      tam=16 fmt=%.02f
18 movto_documento      tam=9
19 total_entrada	tam=10 fmt=%.02f	func=soma	campo=movto_entrada
20 total_saida          tam=10 fmt=%.02f	func=soma	campo=movto_saida
21 movto_obs	        tam=19
22 empresa_nome		tam=60
23 total_emp_entrada	tam=10 fmt=%.02f
24 total_emp_saida	tam=10 fmt=%.02f
25 saldo_emp_ant	tam=12 fmt=%.02f</apelidos><cab_pagina>
#1                                                                                                        #2
----------------------------------------------------------------------------------------------------------------------------
   

LIVRO CAIXA
Período de #3         a #4

</cab_pagina>
<cab_grupo nome="2" quebra="empresa_nome">


+--------------------------------------------------------------------------------------------------------------------------+
| Empresa: #22                                                                                                   Analitico |
+--------------------------------------------------------------------------------------------------------------------------+
</cab_grupo>

<cab_grupo nome="3" quebra="conta_nome" repeticao="0">
+--------------------------------------------------------------------------------------------------------------------------+
| Conta: #5                                                                                Saldo inicial: #17              |
</cab_grupo>

<cab_grupo nome="4" quebra="conta_nome, movto_data">
+--------------------------------------------------------------------------------------------------------------------------+
| Data: #7                                                                                                                 |
+-----+-----+-----------+-------------------+-----------+-----------+---------------+----------------+---------------------+
| Tur | Seq | Documento | Motivo            | Entrada   | Saída     | Saldo         | Responsável    | Observação          |
+-----+-----+-----------+-------------------+-----------+-----------+---------------+----------------+---------------------+
</cab_grupo>

<detalhe>
| #8  | #9  | #18       | #10               | #11       | #12       | #13           | #14            | #21                 |
</detalhe>

<rod_grupo nome="4">
+-----+-----+-----------+-------------------+-----------+-----------+---------------+----------------+---------------------+
| TOTAL                                     | #15       | #16       | #13           |                                      |
+-----+-----+-----------+-------------------+-----------+-----------+---------------+----------------+---------------------+
</rod_grupo>

<rod_grupo nome="3">
</rod_grupo>

<rod_grupo nome="2">
</rod_grupo>

<rod_pagina>
+-----+-----+-----------+-------------------+-----------+-----------+---------------+----------------+---------------------+
</rod_pagina>

<rod_relat>


+-------------------------------------------+-----------+-----------+------------------------------------------------------+
| TOTAL GERAL                               | #19       | #20       |                                                      |
+-------------------------------------------+-----------+-----------+------------------------------------------------------+
</rod_relat>
</layout><layout dados="select      conta_nome,     movto_data,     motivo_nome,     movto_saldo_ant,     (case when t.operacao = &apos;S&apos; then conta_nome_deb else conta_nome_cred end) as movto_contra_partida,     coalesce((case when t.operacao = &apos;E&apos; then sum(valor) end),0) as movto_entrada,     coalesce((case when t.operacao = &apos;S&apos; then sum(valor) end),0) as movto_saida from     (select          distinct pessoa_nome(m.empresa) as empresa_nome,         c.nome as conta_nome,         m.data as movto_data,         mm.nome as motivo_nome,         m.valor,         (case when m.conta_debitar = c.codigo then &apos;E&apos; else &apos;S&apos; end) as operacao,         conta_saldo_empresa(c.codigo, $data_ini::date, m.empresa) as movto_saldo_ant,         (select distinct cd.nome from movto mv, conta cd where mv.grid=m.grid and mv.conta_debitar=cd.codigo and (mv.conta_debitar=c.codigo or                 mv.conta_creditar=c.codigo)) as conta_nome_deb,         (select distinct cc.nome from movto mv, conta cc where mv.grid=m.grid and mv.conta_creditar=cc.codigo and (mv.conta_debitar=c.codigo or             mv.conta_creditar=c.codigo)) as conta_nome_cred     from          movto m             join motivo_movto mm on (m.motivo=mm.grid)            join conta c on (m.conta_debitar = c.codigo or m.conta_creditar = c.codigo)      where          (case when $exibir_conta_filha = 0 then (case when $conta is null then true else c.codigo = $conta end) else (case when $conta is null                 then true else c.codigo like $conta||&apos;%&apos; end) end)     and     m.data between $data_ini and $data_fim     and     (case when $pessoa is null then true else m.pessoa = $pessoa end)     and     (case when $empresa is null then true else m.empresa = $empresa end)     and     (case when $turno is null then true else m.turno = $turno end)     and     c.livro_caixa      and     (case when $exibir_conta_ativo = 0 then true else (m.conta_debitar like &apos;1.%&apos; or m.conta_creditar like &apos;1.%&apos; or m.conta_debitar like &apos;2.%&apos;                 or m.conta_creditar like &apos;2.%&apos;) end)     and     (case when $lancamento = 1 then true when $lancamento = 2 then m.grid in (select grid from movto where grid=m.grid and conta_debitar = c.codigo) else m.grid in (select grid from movto where grid=m.grid and conta_creditar = c.codigo) end)) t group by     empresa_nome,     conta_nome,     movto_data,     motivo_nome,     operacao,     movto_saldo_ant,     conta_nome_deb,     conta_nome_cred order by      1, 2, 3" id="bff11aa8b6e279dfe6c23bfe8d60bc88" ordem="" titulo="Sintético por Conta"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
3  data_ini             tam=10 fmt=data
4  data_fim             tam=10 fmt=data
5  conta_nome           tam=40
6  movto_saldo_ant	tam=16 fmt=%.02f
7  movto_data           tam=10 fmt=data
8  motivo_nome          tam=30
9  movto_entrada        tam=12 fmt=%.02f
10 movto_saida          tam=12 fmt=%.02f
11 movto_saldo          tam=16 fmt=%.02f	expr=((movto_total_entrada-movto_total_saida)+movto_saldo_ant)
12 movto_contra_partida tam=20
13 movto_total_entrada	tam=12 fmt=%.02f	func=soma	campo=movto_entrada	grupo=1
14 movto_total_saida    tam=12 fmt=%.02f	func=soma	campo=movto_saida	grupo=1
15 total_entrada	tam=12 fmt=%.02f	func=soma	campo=movto_entrada
16 total_saida		tam=12 fmt=%.02f	func=soma	campo=movto_saida</apelidos><cab_pagina>
#1                                                                                                  #2        
--------------------------------------------------------------------------------------------------------------------
   
LIVRO CAIXA
Período de #3         a #4
   
</cab_pagina>
<cab_grupo nome="1" quebra="conta_nome">
+------------------------------------------------------------------------------------------------------------------+
| Conta: #5                                                                                              Sintético |
+------------+--------------------------------+-------------+-------------+-----------------+----------------------+
| Data       | Historico                      | Entrada     | Saida       | Saldo           | Contra Partida       |
+------------+--------------------------------+-------------+-------------+-----------------+----------------------+
</cab_grupo>
<cab_grupo nome="2" quebra="conta_nome" repeticao="0">
| Saldo inicial                                                            #6               |                      |
</cab_grupo>
<detalhe>
| #7         | #8                             |#9           |#10          |#11              | #12                  |
</detalhe>
<rod_grupo nome="2">
</rod_grupo>
<rod_grupo nome="1">
+------------+--------------------------------+-------------+-------------+-----------------+----------------------+
| TOTAL                                       |#13          |#14          |#11              |                      |
+---------------------------------------------+-------------+-------------+-----------------+----------------------+

</rod_grupo>
<rod_pagina>
+------------+--------------------------------+-------------+-------------+-----------------+----------------------+
</rod_pagina>
<rod_relat>
+---------------------------------------------+-------------+-------------+-----------------+----------------------+
| TOTAL GERAL                                 |#15          |#16          |                                        |
+---------------------------------------------+-------------+-------------+----------------------------------------+
</rod_relat>
</layout><layout dados="select 
    conta_nome,
    movto_mes,
    mes_nome,
    movto_data,
    motivo_nome,
    movto_saldo_ant,
    (case when t.operacao = &apos;S&apos; then conta_nome_deb else conta_nome_cred end) as movto_contra_partida,
    coalesce((case when t.operacao = &apos;E&apos; then sum(valor) end),0) as movto_entrada,
    coalesce((case when t.operacao = &apos;S&apos; then sum(valor) end),0) as movto_saida
from
    (select 
        distinct pessoa_nome(m.empresa) as empresa_nome,
        c.nome as conta_nome,
        m.data as movto_data,
        mm.nome as motivo_nome,
        m.valor,
        (case when m.conta_debitar = c.codigo then &apos;E&apos; else &apos;S&apos; end) as operacao,
        conta_saldo_empresa(c.codigo, (case when to_char(m.data,&apos;mm&apos;)=to_char($data_ini::date,&apos;mm&apos;) then $data_ini else to_char(m.data,             &apos;yyyy-mm-01&apos;) end)::date, m.empresa) as movto_saldo_ant,
        (select distinct cd.nome from movto mv, conta cd where mv.grid=m.grid and mv.conta_debitar=cd.codigo and (mv.conta_debitar=c.codigo or                 mv.conta_creditar=c.codigo)) as conta_nome_deb,
        (select distinct cc.nome from movto mv, conta cc where mv.grid=m.grid and mv.conta_creditar=cc.codigo and (mv.conta_debitar=c.codigo or             mv.conta_creditar=c.codigo)) as conta_nome_cred,
        to_char(m.data,&apos;mm&apos;) as movto_mes,
        (case when to_char(m.data,&apos;mm&apos;) = &apos;01&apos; then &apos;JANEIRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;02&apos; then &apos;FEVEREIRO&apos; when to_char(m.data,&apos;mm&apos;) =                 &apos;03&apos; then &apos;MARÇO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;04&apos; then &apos;ABRIL&apos; when to_char(m.data,&apos;mm&apos;) = &apos;05&apos; then &apos;MAIO&apos; when                 to_char    (m.data,&apos;mm&apos;) = &apos;06&apos; then &apos;JUNHO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;07&apos; then &apos;JULHO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;08&apos; then                 &apos;AGOSTO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;09&apos; then &apos;SETEMBRO&apos; when to_char(m.data,&apos;mm&apos;) = &apos;10&apos; then &apos;OUTUBRO&apos; when                 to_char(m.data,&apos;mm&apos;) = &apos;11&apos; then &apos;NOVEMBRO&apos; else &apos;DEZEMBRO&apos; end) as mes_nome
    from 
        movto m 
           join motivo_movto mm on (m.motivo=mm.grid)
           join conta c on (m.conta_debitar = c.codigo or m.conta_creditar = c.codigo) 
    where 
        (case when $exibir_conta_filha = 0 then (case when $conta is null then true else c.codigo = $conta end) else (case when $conta is null                 then true else c.codigo like $conta||&apos;%&apos; end) end)
    and     m.data between $data_ini and $data_fim
    and     (case when $pessoa is null then true else m.pessoa = $pessoa end)
    and     (case when $empresa is null then true else m.empresa = $empresa end)
    and     (case when $turno is null then true else m.turno = $turno end)
    and     c.livro_caixa 
    and     (case when $exibir_conta_ativo = 0 then true else (m.conta_debitar like &apos;1.%&apos; or m.conta_creditar like &apos;1.%&apos; or m.conta_debitar like &apos;2.%&apos;                 or m.conta_creditar like &apos;2.%&apos;) end)
    and     (case when $lancamento = 1 then true when $lancamento = 2 then m.grid in (select grid from movto where grid=m.grid and conta_debitar = c.codigo) else m.grid in (select grid from movto where grid=m.grid and conta_creditar = c.codigo) end)) t
group by
    movto_mes,
    mes_nome,
    conta_nome,
    movto_data,
    motivo_nome,
    operacao,
    movto_saldo_ant,
    conta_nome_deb,
    conta_nome_cred
order by 
    1, 2, 3" id="ae1696ccc7da85d3978f9837bee335e1" ordem="" titulo="Sintético por Mês"><apelidos>1  rel_posto_nome       tam=60
2  rel_data_hora        tam=18
3  data_ini             tam=10 fmt=data
4  data_fim             tam=10 fmt=data
5  conta_nome           tam=40
6  movto_saldo_ant	tam=14 fmt=%.02f
7  movto_data           tam=10 fmt=data
8  motivo_nome          tam=30
9  movto_entrada        tam=12 fmt=%.02f
10 movto_saida          tam=12 fmt=%.02f
11 movto_saldo          tam=14 fmt=%.02f	expr=((movto_total_entrada-movto_total_saida)+movto_saldo_ant)
12 movto_contra_partida tam=20
13 movto_total_entrada	tam=12 fmt=%.02f	func=soma	campo=movto_entrada	grupo=1
14 movto_total_saida    tam=12 fmt=%.02f	func=soma	campo=movto_saida	grupo=1
15 total_entrada	tam=12 fmt=%.02f	func=soma	campo=movto_entrada
16 total_saida		tam=12 fmt=%.02f	func=soma	campo=movto_saida
17 mes_nome		tam=100</apelidos><cab_pagina>
#1                                                                                            #2        
------------------------------------------------------------------------------------------------------------------
   
LIVRO CAIXA
Período de #3         a #4
   
</cab_pagina>
<cab_grupo nome="1" quebra="conta_nome">
+----------------------------------------------------------------------------------------------------------------+
| Conta: #5                                                                                            Sintético |
+----------------------------------------------------------------------------------------------------------------+
</cab_grupo>
<cab_grupo nome="3" quebra="conta_nome,movto_mes">
+----------------------------------------------------------------------------------------------------------------+
| Mês: #17                                                                                                       |
+------------+--------------------------------+-------------+-------------+---------------+----------------------+
| Data       | Historico                      | Entrada     | Saida       | Saldo         | Contra Partida       |
+------------+--------------------------------+-------------+-------------+---------------+----------------------+
</cab_grupo>
<cab_grupo nome="2" quebra="conta_nome,movto_mes" repeticao="0">
| Saldo inicial                                                            #6             |                      |
</cab_grupo>
<detalhe>
| #7         | #8                             |#9           |#10          |#11            | #12                  |
</detalhe>
<rod_grupo nome="2">
</rod_grupo>
<rod_grupo nome="3">
+------------+--------------------------------+-------------+-------------+---------------+----------------------+
| SUBTOTAL                                    |#13          |#14          |#11            |                      |
+---------------------------------------------+-------------+-------------+---------------+----------------------+
</rod_grupo>
<rod_grupo nome="1">
+------------+--------------------------------+-------------+-------------+---------------+----------------------+
| TOTAL                                       |#13          |#14          |#11            |                      |
+---------------------------------------------+-------------+-------------+---------------+----------------------+

</rod_grupo>
<rod_pagina>
+------------+--------------------------------+-------------+-------------+---------------+----------------------+
</rod_pagina>
<rod_relat>
+---------------------------------------------+-------------+-------------+---------------+----------------------+
| TOTAL GERAL                                 |#15          |#16          |                                      |
+---------------------------------------------+-------------+-------------+--------------------------------------+
</rod_relat>
</layout></relatorio>