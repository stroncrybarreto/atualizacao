<?xml version='1.0' encoding='iso8859-1'?>
<relatorio ts="2008-11-04 10:44:20" versao_xml="0.1"><tela titulo="Extrato de Notas e Faturas">
  <quadro titulo="Parâmetros">
    <procura id="empresa" modelo="empresa" titulo="Empresa" valor_padrao="select empresa from empresa_local" />
    <procura id="conta_nota" modelo="conta" requerido="sim" titulo="Conta Notas" valor_padrao="select &apos;1.3.08&apos;" />
    <procura id="conta_fatura" modelo="conta" requerido="sim" titulo="Conta Faturas" valor_padrao="select &apos;1.3.09.1&apos;" />
    <procura id="grupo" modelo="grupo_pessoa" titulo="Grupo Cliente" />
    <procura id="cliente" modelo="pessoa" titulo="Cliente" />
    <campo id="data" modelo="periodo" titulo="Período" valor_padrao="select to_char(current_date, &apos;YYYY-mm-01&apos;)::date, to_char(current_date + interval &apos;1 month&apos;, &apos;YYYY-mm-01&apos;)::date - 1" />
    <caixa>
      <campo id="refer" tipo="data" titulo="Data Referência" />
      <rotulo titulo="* Utilizar para posição de uma data retroativa" />
    </caixa>
    <selecao id="exibir" origem="values (1,&apos;Todas&apos;),(2,&apos;Quitadas&apos;),(3,&apos;Em aberto&apos;)" requerido="sim" titulo="Exibir" />
    <selecao id="ordena" origem="values (1,&apos;Documento&apos;),(2,&apos;Vencimento&apos;),(3,&apos;Valor&apos;)" requerido="sim" titulo="Ordenação" />
  </quadro>
</tela><ajuda /><layout dados="select      (case when $ordena = 1 then documento::text when $ordena = 2 then vencto::text else t.valor::text end) as ordena,     t.*,     coalesce(t.valor,0) as valor_fat,     coalesce((select sum(x.valor) from movto x left join pessoa p on (p.grid=x.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $exibir = 1 then true when $exibir = 2 then x.child &lt;&gt; 0 else x.child = 0 end) and (case when $empresa is null then true else x.empresa = $empresa end) and x.pessoa = t.pessoa and x.conta_debitar = $conta_nota and x.data between $data_ini and $data_fim),0) as total_nota,     coalesce((select sum(x.valor) from movto x left join pessoa p on (p.grid = x.pessoa) left join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $exibir = 1 then true when $exibir = 2 then x.child &lt;&gt; 0 else x.child = 0 end) and (case when $empresa is null then true else x.empresa = $empresa end) and (case when $cliente is null then true else x.pessoa = $cliente end) and (case when $grupo is null then true else gp.grid = $grupo end) and x.conta_debitar = $conta_nota and x.data between $data_ini and $data_fim),0) as total_geral_nota from     (select          mm.nome as motivo_nome,          p.codigo as pessoa_codigo,          p.nome as pessoa_nome,          p.grid as pessoa,          m.documento,         to_char(m.data,&apos;dd/mm/yyyy&apos;) as data,         m.valor,         to_char(m.vencto,&apos;dd/mm/yyyy&apos;) as vencto     from          movto m             left join pessoa p on (p.grid=m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)             left join motivo_movto mm on (m.motivo=mm.grid)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)      and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_creditar =  $conta_nota     and     m.conta_debitar =  $conta_fatura     and     m.data between $data_ini and $data_fim     UNION ALL     select distinct         &apos;NENHUMA FATURA EM ABERTO&apos; as motivo_nome,          p.codigo as pessoa_codigo,          p.nome as pessoa_nome,          p.grid as pessoa,          &apos;&apos; as documento,         &apos;&apos; as data,         0 as valor,         &apos;&apos; as vencto     from          movto m            left join pessoa p on (p.grid = m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)     and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_debitar = $conta_nota     and     m.data between $data_ini and $data_fim     and     m.pessoa not in (select p.grid from movto m join pessoa p on (p.grid=m.pessoa) join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end) and (case when $empresa is null then true else m.empresa = $empresa end) and (case when $cliente is null then true else m.pessoa = $cliente end) and (case when $grupo is null then true else gp.grid = $grupo end) and m.conta_creditar = $conta_nota and m.conta_debitar = $conta_fatura and m.data between $data_ini and $data_fim)) t order by      pessoa_nome,      1" id="6f42d177f05347f0efdca912dd54c7d6" ordem="" titulo="Sintético"><apelidos>1  rel_posto_nome	tam=60
2  rel_data_hora	tam=18
3  titulo1		tam=98	alinha=centro
4  titulo2		tam=98	alinha=centro
5  pessoa_codigo	tam=6 	fmt=%d
6  pessoa_nome		tam=45
7  tipo_nome		tam=20
8  documento		tam=9
9  data			tam=10
10 motivo_nome		tam=40
11 vencto		tam=10
12 valor_fat		tam=13	fmt=%.02f
13 total_tipo		tam=13	fmt=%.02f
14 total_nota		tam=13	fmt=%.02f
15 total_fatura		tam=13	fmt=%.02f	func=soma	campo=valor_fat	grupo=1
16 total_pessoa		tam=13	fmt=%.02f	expr=total_fatura+total_nota
17 total_geral_nota	tam=13	fmt=%.02f
18 total_geral_fatura	tam=13	fmt=%.02f	func=soma	campo=valor_fat
19 total_geral		tam=13	fmt=%.02f	expr=total_geral_fatura+total_geral_nota
20 data_ini		tam=10	fmt=data
21 data_fim		tam=10	fmt=data</apelidos><cab_pagina>
#1                                                                                #2              
--------------------------------------------------------------------------------------------------

                E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Sintetico
                               Período: #20        a #21

</cab_pagina>

<cab_grupo nome="1" quebra="pessoa">
Cliente: #5     - #6                                               Total de notas: #14
+-----------+------------+------------------------------------------+------------+---------------+
| Documento | Dt.Emissao | Motivo                                   | Vencimento |         Valor |
+-----------+------------+------------------------------------------+------------+---------------+
</cab_grupo>
<detalhe>
| #8        | #9         | #10                                      | #11        | #12           |
</detalhe>
<rod_grupo nome="1">
+-----------+------------+------------------------------------------+------------+---------------+
|                                                              Total de FATURAS: | #15           |
|                                                              Total do CLIENTE: | #16           |
+--------------------------------------------------------------------------------+---------------+

</rod_grupo>

<rod_pagina>
+-----------+------------+------------------------------------------+------------+---------------+
</rod_pagina>

<rod_relat>

+--------------------------------------------------------------------------------+---------------+
|                                                                Total de NOTAS: | #17           |
|                                                              Total de FATURAS: | #18           |
|                                                                   Total GERAL: | #19           |
+--------------------------------------------------------------------------------+---------------+
</rod_relat>
</layout><layout dados="select      (case when $ordena = 1 then documento::text when $ordena = 2 then vencto::text else t.valor::text end) as ordena,     mm.nome as motivo_nome,      p.codigo as pessoa_codigo,      p.nome as pessoa_nome,      p.grid as pessoa,      t.*,     (case when t.tipo = 0 then valor else 0 end) as nota,     (case when t.tipo = 1 then valor else 0 end) as fatura,     (select nome from conta where codigo = (case when t.tipo = 0 then $conta_nota else $conta_fatura end)) as tipo_nome from       (select          m.*,          0::int as tipo      from          movto m             left join pessoa p on (p.grid=m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)     and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_debitar = $conta_nota     and     m.data between $data_ini and $data_fim     and     m.pessoa not in (select p.grid from movto m join pessoa p on (p.grid=m.pessoa) join grupo_pessoa gp on (gp.grid=p.grupo) where (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end) and (case when $empresa is null then true else m.empresa = $empresa end) and (case when $cliente is null then true else m.pessoa = $cliente end) and (case when $grupo is null then true else gp.grid = $grupo end) and m.conta_creditar = $conta_nota and m.conta_debitar = $conta_fatura and m.data between $data_ini and $data_fim)     union all      select          m.*,          1::int as tipo      from          movto m             left join pessoa p on (p.grid=m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)      and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_creditar =  $conta_nota     and     m.conta_debitar =  $conta_fatura     and     m.data between $data_ini and $data_fim) t         left join pessoa p on (t.pessoa=p.grid)         left join motivo_movto mm on (t.motivo=mm.grid)  order by      p.grid,      p.nome,      1,     t.tipo " id="5a613260166ed001173e5fa0593afbb9" ordem="" titulo="Analítico"><apelidos>1  rel_posto_nome	tam=60
2  rel_data_hora	tam=18
3  titulo1		tam=98	alinha=centro
4  titulo2		tam=98	alinha=centro
5  pessoa_codigo	tam=6 	fmt=%d
6  pessoa_nome		tam=45
7  tipo_nome		tam=20
8  documento		tam=9
9  data			tam=10	fmt=data
10 motivo_nome		tam=40
11 vencto		tam=10	fmt=data
12 valor		tam=13	fmt=%.02f
13 total_tipo		tam=13	fmt=%.02f	func=soma	campo=valor	grupo=2
16 total_pessoa		tam=13	fmt=%.02f	func=soma	campo=valor	grupo=1
17 total_nota		tam=13	fmt=%.02f	func=soma	campo=nota
18 total_fatura		tam=13	fmt=%.02f	func=soma	campo=fatura
19 total_geral		tam=13	fmt=%.02f	expr=total_fatura+total_nota
20 data_ini		tam=10	fmt=data
21 data_fim		tam=10	fmt=data</apelidos><cab_pagina>
#1                                                                                #2              
--------------------------------------------------------------------------------------------------

                E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Analitico
                                  Período: #20        a #21

</cab_pagina>

<cab_grupo nome="1" quebra="pessoa">
Cliente: #5     - #6
+-----------+------------+------------------------------------------+------------+---------------+
| Documento | Dt.Emissao | Motivo                                   | Vencimento |         Valor |
+-----------+------------+------------------------------------------+------------+---------------+
</cab_grupo>
<cab_grupo nome="2" quebra="pessoa,tipo">
| #7                                                                                             |
</cab_grupo>
<detalhe>
| #8        | #9         | #10                                      | #11        | #12           |
</detalhe>
<rod_grupo nome="2">
|                                                                         Total: | #13           |
</rod_grupo>
<rod_grupo nome="1">
+-----------+------------+------------------------------------------+------------+---------------+
|                                                              Total do CLIENTE: | #16           |
+--------------------------------------------------------------------------------+---------------+

</rod_grupo>

<rod_pagina>
+-----------+------------+------------------------------------------+------------+---------------+
</rod_pagina>

<rod_relat>

+--------------------------------------------------------------------------------+---------------+
|                                                                Total de NOTAS: | #17           |
|                                                              Total de FATURAS: | #18           |
|                                                                   Total GERAL: | #19           |
+--------------------------------------------------------------------------------+---------------+
</rod_relat>
</layout><layout dados="select      cliente_codigo,     cliente_nome,     sum(m.nota) as nota_emitida,      sum(m.nota_pendente) as nota_pendente,      sum(m.fatura) as nota_faturada,      sum(m.fatura_pendente) as fatura_pendente from      (select          p.codigo as cliente_codigo,          p.nome as cliente_nome,          m.valor as nota,          (case when m.child=0 then m.valor else 0::float end) as nota_pendente,         0 as fatura,         0 as fatura_pendente     from          movto m             left join pessoa p on (p.grid=m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)     and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_debitar = $conta_nota     and     m.data between $data_ini and $data_fim     UNION ALL     select          p.codigo as cliente_codigo,          p.nome as cliente_nome,          0 as nota,         0 as nota_pendente,         m.valor as fatura,         (case when child = 0 then valor else 0 end) as fatura_pendente     from          movto m             left join pessoa p on (p.grid=m.pessoa)             left join grupo_pessoa gp on (gp.grid=p.grupo)      where          (case when $exibir = 1 then true when $exibir = 2 then m.child &lt;&gt; 0 else m.child = 0 end)      and     (case when $empresa is null then true else m.empresa = $empresa end)      and     (case when $cliente is null then true else m.pessoa = $cliente end)     and     (case when $grupo is null then true else gp.grid = $grupo end)     and     m.conta_creditar =  $conta_nota     and     m.conta_debitar =  $conta_fatura     and     m.data between $data_ini and $data_fim) m group by      cliente_codigo,     cliente_nome" id="ee8619a6a8fe0e32c8bfadf9e5450401" ordem="" titulo="Resumido"><apelidos>1  rel_posto_nome		tam=60
2  rel_data_hora		tam=18
3  titulo1			tam=146	alinha=centro
4  titulo2			tam=146	alinha=centro
5  data_ini			tam=10	fmt=data
6  data_fim			tam=10	fmt=data

10 cliente_nome			tam=29
11 cliente_codigo		tam=6

20 nota_emitida			tam=13	fmt=%.02f
21 nota_recebida		tam=12	fmt=%.02f	expr=nota_emitida-nota_faturada-nota_pendente
22 nota_pendente		tam=12	fmt=%.02f
23 nota_faturada		tam=12	fmt=%.02f
24 fatura_recebida		tam=12	fmt=%.02f	expr=nota_faturada-fatura_pendente
25 fatura_pendente		tam=12	fmt=%.02f
26 subtotal_recebido		tam=12	fmt=%.02f	expr=nota_recebida+fatura_recebida
27 subtotal_pendente		tam=12	fmt=%.02f	expr=nota_pendente+fatura_pendente

80 total_nota_emitida		tam=13	fmt=%.02f	func=soma	campo=nota_emitida
81 total_nota_recebida		tam=12	fmt=%.02f	func=soma	campo=nota_recebida
82 total_nota_pendente		tam=12	fmt=%.02f	func=soma	campo=nota_pendente
83 total_nota_faturada		tam=12	fmt=%.02f	func=soma	campo=nota_faturada
84 total_fatura_recebida	tam=12	fmt=%.02f	func=soma	campo=fatura_recebida
85 total_fatura_pendente	tam=12	fmt=%.02f	func=soma	campo=fatura_pendente
86 total_recebido		tam=12	fmt=%.02f	func=soma	campo=subtotal_recebido
87 total_pendente		tam=12	fmt=%.02f	func=soma	campo=subtotal_pendente</apelidos><cab_pagina>
#1                                                                                                                                #2              
--------------------------------------------------------------------------------------------------------------------------------------------------

                                         E X T R A T O   D E   N O T A S   E   F A T U R A S  -  Resumido
                                                      Emissao entre #5         e #6

+-------------------------------+--------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
|                               |        Notas |       Notas |       Notas |       Notas |     Faturas |      Fatura |       Total |       Total |
| Cliente                       |     Emitidas |   Recebidas |   Pendentes |   Faturadas |   Recebidas |   Pendentes |    Recebido |    Pendente |
+-------------------------------+--------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</cab_pagina>

<detalhe>
| #10                           |#20           |#21          |#22          |#23          |#24          |#25          |#26          |#27          |
</detalhe>

<rod_relat>
+-------------------------------+--------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
| TOTAL                         |#80           |#81          |#82          |#83          |#84          |#85          |#86          |#87          |
+-------------------------------+--------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</rod_relat>

<rod_pagina>
+-------------------------------+--------------+-------------+-------------+-------------+-------------+-------------+-------------+-------------+
</rod_pagina>
</layout></relatorio>